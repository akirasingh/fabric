
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chaincode as an external service &#8212; hyperledger-fabricdocs master documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Error handling" href="error-handling.html" />
    <link rel="prev" title="External Builders and Launchers" href="cc_launcher.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="index.html">
    
      <p class="title">hyperledger-fabricdocs</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="intro.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="whatsnew.html">What’s new in Hyperledger Fabric v2.x</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href=""></a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="key_concepts.html">Key Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started.html">Getting Started - Install</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started_run_fabric.html">Getting Started - Run Fabric</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="developapps/developing_applications.html">Developing Applications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="deployment_guide_overview.html">Deploying a production network</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="ops_guide.html">Operations Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="upgrade.html">Upgrading to the latest release</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="command_ref.html">Commands Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="architecture.html">Architecture Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="Fabric-FAQ.html">Frequently Asked Questions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="CONTRIBUTING.html">Contributions Welcome!</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="glossary.html">Glossary</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="releases.html">Releases</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="questions.html">Still Have Questions?</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="status.html">Status</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="msp.html">Membership Service Providers (MSP)</a>
                </li>
            
          
            
                <li class="">
                    <a href="peer_ledger_snapshot.html">Taking ledger snapshots and using them to join channels</a>
                </li>
            
          
            
                <li class="">
                    <a href="hsm.html">Using a Hardware Security Module (HSM)</a>
                </li>
            
          
            
                <li class="">
                    <a href="configtx.html">Channel Configuration (configtx)</a>
                </li>
            
          
            
                <li class="">
                    <a href="endorsement-policies.html">Endorsement policies</a>
                </li>
            
          
            
                <li class="">
                    <a href="pluggable_endorsement_and_validation.html">Pluggable transaction endorsement and validation</a>
                </li>
            
          
            
                <li class="">
                    <a href="access_control.html">Access Control Lists (ACL)</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemix.html">MSP Implementation with Identity Mixer</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemixgen.html">Identity Mixer MSP configuration generator (idemixgen)</a>
                </li>
            
          
            
                <li class="">
                    <a href="operations_service.html">The Operations Service</a>
                </li>
            
          
            
                <li class="">
                    <a href="metrics_reference.html">Metrics Reference</a>
                </li>
            
          
            
                <li class="">
                    <a href="cc_launcher.html">External Builders and Launchers</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Chaincode as an external service</a>
                </li>
            
          
            
                <li class="">
                    <a href="error-handling.html">Error handling</a>
                </li>
            
          
            
                <li class="">
                    <a href="logging-control.html">Logging Control</a>
                </li>
            
          
            
                <li class="">
                    <a href="enable_tls.html">Securing Communication With Transport Layer Security (TLS)</a>
                </li>
            
          
            
                <li class="">
                    <a href="raft_configuration.html">Configuring and operating a Raft ordering service</a>
                </li>
            
          
            
                <li class="">
                    <a href="kafka_raft_migration.html">Migrating from Kafka to Raft</a>
                </li>
            
          
            
                <li class="">
                    <a href="kafka.html">Bringing up a Kafka-based Ordering Service</a>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#packaging-chaincode" class="nav-link">Packaging chaincode</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#configuring-a-peer-to-process-external-chaincode" class="nav-link">Configuring a peer to process external chaincode</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#modify-the-peer-core-yaml-to-include-the-externalbuilder" class="nav-link">Modify the peer core.yaml to include the externalBuilder</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#external-builder-and-launcher-sample-scripts" class="nav-link">External builder and launcher sample scripts</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#bin-detect" class="nav-link">bin/detect</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#bin-build" class="nav-link">bin/build</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#bin-release" class="nav-link">bin/release</a>
        </li>
    
            </ul>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#writing-chaincode-to-run-as-an-external-service" class="nav-link">Writing chaincode to run as an external service</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#go" class="nav-link">Go</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#node-js" class="nav-link">Node.js</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#deploying-the-chaincode" class="nav-link">Deploying the chaincode</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#running-the-chaincode-as-an-external-service" class="nav-link">Running the chaincode as an external service</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="chaincode-as-an-external-service">
<h1>Chaincode as an external service<a class="headerlink" href="#chaincode-as-an-external-service" title="Permalink to this headline">¶</a></h1>
<p>Fabric v2.0 supports chaincode deployment and execution outside of Fabric that enables users to manage a chaincode runtime independently of the peer. This facilitates deployment of chaincode on Fabric cloud deployments such as Kubernetes. Instead of building and launching the chaincode on every peer, chaincode can now run as a service whose lifecycle is managed outside of Fabric. This capability leverages the Fabric v2.0 external builder and launcher functionality which enables operators to extend a peer with programs to build, launch, and discover chaincode. Before reading this topic you should become familiar with the <a class="reference external" href="./cc_launcher.html">External Builder and Launcher</a> content.</p>
<p>Prior to the availability of the external builders, the chaincode package content was required to be a set of source code files for a particular language which could be built and launched as a chaincode binary. The new external build and launcher functionality now allows users to optionally customize the build process. With respect to running the chaincode as an external service, the build process allows you to specify the endpoint information of the server where the chaincode is running. Hence the package simply consists of the externally running chaincode server endpoint information and TLS artifacts for secure connection. TLS is optional but highly recommended for all environments except a simple test environment.</p>
<p>The rest of this topic describes how to configure chaincode as an external service:</p>
<ul class="simple">
<li><p><a class="reference external" href="#packaging-chaincode">Packaging chaincode</a></p></li>
<li><p><a class="reference external" href="#configuring-a-peer-to-process-external-chaincode">Configuring a peer to process external chaincode</a></p></li>
<li><p><a class="reference external" href="#external-builder-and-launcher-sample-scripts">External builder and launcher sample scripts</a></p></li>
<li><p><a class="reference external" href="#writing-chaincode-to-run-as-an-external-service">Writing chaincode to run as an external service</a></p></li>
<li><p><a class="reference external" href="#deploying-the-chaincode">Deploying the chaincode</a></p></li>
<li><p><a class="reference external" href="#running-the-chaincode-as-an-external-service">Running the chaincode as an external service</a></p></li>
</ul>
<p><strong>Note:</strong> This is an advanced feature that will likely require custom packaging of the peer image. For example, the following samples use <code class="docutils literal notranslate"><span class="pre">jq</span></code> and <code class="docutils literal notranslate"><span class="pre">bash</span></code>, which are not included in the current official <code class="docutils literal notranslate"><span class="pre">fabric-peer</span></code> image.</p>
<div class="section" id="packaging-chaincode">
<h2>Packaging chaincode<a class="headerlink" href="#packaging-chaincode" title="Permalink to this headline">¶</a></h2>
<p>With the Fabric v2.0 chaincode lifecycle, chaincode is <a class="reference external" href="./cc_launcher.html#chaincode-packages">packaged</a> and installed in a <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code> format. The following <code class="docutils literal notranslate"><span class="pre">myccpackage.tgz</span></code> archive  demonstrates the required structure:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ tar xvfz myccpackage.tgz
metadata.json
code.tar.gz
</pre></div>
</div>
<p>The chaincode package should be used to provide two pieces of information to the external builder and launcher process</p>
<ul class="simple">
<li><p>identify if the chaincode is an external service. The <code class="docutils literal notranslate"><span class="pre">bin/detect</span></code> section describes an approach using the <code class="docutils literal notranslate"><span class="pre">metadata.json</span></code> file</p></li>
<li><p>provide chaincode endpoint information in a <code class="docutils literal notranslate"><span class="pre">connection.json</span></code> file placed in the release directory. The <code class="docutils literal notranslate"><span class="pre">bin/run</span></code> section describes the <code class="docutils literal notranslate"><span class="pre">connection.json</span></code> file</p></li>
</ul>
<p>There is plenty of flexibility to gathering the above information. The sample scripts in the <a class="reference external" href="#external-builder-and-launcher-sample-scripts">External builder and launcher sample scripts</a> illustrate a simple approach to providing the information.
As an example of flexibility, consider packaging couchdb index files (see <a class="reference external" href="couchdb_tutorial.html#add-the-index-to-your-chaincode-folder">Add the index to your chaincode folder</a>). Sample scripts below describe an approach to packaging the files into myccpackage.tar.gz.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="n">cfz</span> <span class="n">code</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="n">connection</span><span class="o">.</span><span class="n">json</span> <span class="n">metadata</span>
<span class="n">tar</span> <span class="n">cfz</span> <span class="n">myccpackage</span><span class="o">.</span><span class="n">tgz</span> <span class="n">metadata</span><span class="o">.</span><span class="n">json</span> <span class="n">code</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-a-peer-to-process-external-chaincode">
<h2>Configuring a peer to process external chaincode<a class="headerlink" href="#configuring-a-peer-to-process-external-chaincode" title="Permalink to this headline">¶</a></h2>
<p>In this section we go over the configuration needed</p>
<ul class="simple">
<li><p>to detect if the chaincode package identifies an external chaincode service</p></li>
<li><p>to create the <code class="docutils literal notranslate"><span class="pre">connection.json</span></code> file in the release directory</p></li>
</ul>
<div class="section" id="modify-the-peer-core-yaml-to-include-the-externalbuilder">
<h3>Modify the peer core.yaml to include the externalBuilder<a class="headerlink" href="#modify-the-peer-core-yaml-to-include-the-externalbuilder" title="Permalink to this headline">¶</a></h3>
<p>Assume the scripts are on the peer in the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    &lt;fully qualified path on the peer&#39;s env&gt;
    └── bin
        ├── build
        ├── detect
        └── release
</pre></div>
</div>
<p>Modify the <code class="docutils literal notranslate"><span class="pre">chaincode</span></code> stanza of the peer <code class="docutils literal notranslate"><span class="pre">core.yaml</span></code> file to include the <code class="docutils literal notranslate"><span class="pre">externalBuilders</span></code> configuration element:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">externalBuilders</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myexternal</span>
       <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;fully qualified path on the peer&#39;s env&gt;</span>   
</pre></div>
</div>
</div>
<div class="section" id="external-builder-and-launcher-sample-scripts">
<h3>External builder and launcher sample scripts<a class="headerlink" href="#external-builder-and-launcher-sample-scripts" title="Permalink to this headline">¶</a></h3>
<p>To help understand what each script needs to contain to work with the chaincode as an external service, this section contains samples of  <code class="docutils literal notranslate"><span class="pre">bin/detect</span></code> <code class="docutils literal notranslate"><span class="pre">bin/build</span></code>, <code class="docutils literal notranslate"><span class="pre">bin/release</span></code>, and <code class="docutils literal notranslate"><span class="pre">bin/run</span></code> scripts.</p>
<p><strong>Note:</strong> These samples use the <code class="docutils literal notranslate"><span class="pre">jq</span></code> command to parse json. You can run <code class="docutils literal notranslate"><span class="pre">jq</span> <span class="pre">--version</span></code> to check if you have it installed. Otherwise, install <code class="docutils literal notranslate"><span class="pre">jq</span></code> or suitably modify the scripts.</p>
<div class="section" id="bin-detect">
<h4>bin/detect<a class="headerlink" href="#bin-detect" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">bin/detect</span> <span class="pre">script</span></code> is responsible for determining whether or not a buildpack should be used to build a chaincode package and launch it.  For chaincode as an external service, the sample script looks for a <code class="docutils literal notranslate"><span class="pre">type</span></code> property set to <code class="docutils literal notranslate"><span class="pre">external</span></code> in the <code class="docutils literal notranslate"><span class="pre">metadata.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;external&quot;</span><span class="p">,</span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;mycc&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>The peer invokes detect with two arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">detect</span> <span class="n">CHAINCODE_SOURCE_DIR</span> <span class="n">CHAINCODE_METADATA_DIR</span>
</pre></div>
</div>
<p>A sample <code class="docutils literal notranslate"><span class="pre">bin/detect</span></code> script could contain:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span> -euo pipefail

<span class="nv">METADIR</span><span class="o">=</span><span class="nv">$2</span>
<span class="c1">#check if the &quot;type&quot; field is set to &quot;external&quot;</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="k">$(</span>jq -r .type <span class="s2">&quot;</span><span class="nv">$METADIR</span><span class="s2">/metadata.json&quot;</span><span class="k">)</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;external&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">exit</span> <span class="m">0</span>
<span class="k">fi</span>

<span class="nb">exit</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="section" id="bin-build">
<h4>bin/build<a class="headerlink" href="#bin-build" title="Permalink to this headline">¶</a></h4>
<p>For chaincode as an external service, the sample build script assumes the chaincode package’s <code class="docutils literal notranslate"><span class="pre">code.tar.gz</span></code> file contains <code class="docutils literal notranslate"><span class="pre">connection.json</span></code> which it simply copies to the <code class="docutils literal notranslate"><span class="pre">BUILD_OUTPUT_DIR</span></code>. The peer invokes the build script with three arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">build</span> <span class="n">CHAINCODE_SOURCE_DIR</span> <span class="n">CHAINCODE_METADATA_DIR</span> <span class="n">BUILD_OUTPUT_DIR</span>
</pre></div>
</div>
<p>A sample <code class="docutils literal notranslate"><span class="pre">bin/build</span></code> script could contain:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span> -euo pipefail

<span class="nv">SOURCE</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">OUTPUT</span><span class="o">=</span><span class="nv">$3</span>

<span class="c1">#external chaincodes expect connection.json file in the chaincode package</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">/connection.json&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    &gt;<span class="p">&amp;</span><span class="m">2</span> <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">/connection.json not found&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="c1">#simply copy the endpoint information to specified output location</span>
cp <span class="nv">$SOURCE</span>/connection.json <span class="nv">$OUTPUT</span>/connection.json

<span class="k">if</span> <span class="o">[</span> -d <span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">/metadata&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    cp -a <span class="nv">$SOURCE</span>/metadata <span class="nv">$OUTPUT</span>/metadata
<span class="k">fi</span>

<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="section" id="bin-release">
<h4>bin/release<a class="headerlink" href="#bin-release" title="Permalink to this headline">¶</a></h4>
<p>For chaincode as an external service, the <code class="docutils literal notranslate"><span class="pre">bin/release</span></code> script is responsible for providing the <code class="docutils literal notranslate"><span class="pre">connection.json</span></code> to the peer by placing it in the <code class="docutils literal notranslate"><span class="pre">RELEASE_OUTPUT_DIR</span></code>.  The <code class="docutils literal notranslate"><span class="pre">connection.json</span></code> file has the following JSON structure</p>
<ul class="simple">
<li><p><strong>address</strong> - chaincode server endpoint accessible from peer. Must be specified in “<host>:<port>” format.</p></li>
<li><p><strong>dial_timeout</strong> - interval to wait for connection to complete. Specified as a string qualified with time units (e.g, “10s”, “500ms”, “1m”). Default is “3s” if not specified.</p></li>
<li><p><strong>tls_required</strong> - true or false. If false, “client_auth_required”, “client_key”, “client_cert”, and “root_cert” are not required. Default is “true”.</p></li>
<li><p><strong>client_auth_required</strong> - if true, “client_key” and “client_cert” are required. Default is false. It is ignored if tls_required is false.</p></li>
<li><p><strong>client_key</strong> - PEM encoded string of the client private key.</p></li>
<li><p><strong>client_cert</strong>  - PEM encoded string of the client certificate.</p></li>
<li><p><strong>root_cert</strong>  - PEM encoded string of the server (peer) root certificate.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;your.chaincode.host.com:9999&quot;</span><span class="p">,</span>
  <span class="nt">&quot;dial_timeout&quot;</span><span class="p">:</span> <span class="s2">&quot;10s&quot;</span><span class="p">,</span>
  <span class="nt">&quot;tls_required&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_auth_required&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_key&quot;</span><span class="p">:</span> <span class="s2">&quot;-----BEGIN EC PRIVATE KEY----- ... -----END EC PRIVATE KEY-----&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_cert&quot;</span><span class="p">:</span> <span class="s2">&quot;-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE-----&quot;</span><span class="p">,</span>
  <span class="nt">&quot;root_cert&quot;</span><span class="p">:</span> <span class="s2">&quot;-----BEGIN CERTIFICATE---- ... -----END CERTIFICATE-----&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As noted in the <code class="docutils literal notranslate"><span class="pre">bin/build</span></code> section, this sample assumes the chaincode package directly contains the <code class="docutils literal notranslate"><span class="pre">connection.json</span></code> file which the build script copies to the <code class="docutils literal notranslate"><span class="pre">BUILD_OUTPUT_DIR</span></code>. The peer invokes the release script with two arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">release</span> <span class="n">BUILD_OUTPUT_DIR</span> <span class="n">RELEASE_OUTPUT_DIR</span>
</pre></div>
</div>
<p>A sample <code class="docutils literal notranslate"><span class="pre">bin/release</span></code> script could contain:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span> -euo pipefail

<span class="nv">BLD</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="nv">RELEASE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="o">[</span> -d <span class="s2">&quot;</span><span class="nv">$BLD</span><span class="s2">/metadata&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
   cp -a <span class="s2">&quot;</span><span class="nv">$BLD</span><span class="s2">/metadata/&quot;</span>* <span class="s2">&quot;</span><span class="nv">$RELEASE</span><span class="s2">/&quot;</span>
<span class="k">fi</span>

<span class="c1">#external chaincodes expect artifacts to be placed under &quot;$RELEASE&quot;/chaincode/server</span>
<span class="k">if</span> <span class="o">[</span> -f <span class="nv">$BLD</span>/connection.json <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
   mkdir -p <span class="s2">&quot;</span><span class="nv">$RELEASE</span><span class="s2">&quot;</span>/chaincode/server
   cp <span class="nv">$BLD</span>/connection.json <span class="s2">&quot;</span><span class="nv">$RELEASE</span><span class="s2">&quot;</span>/chaincode/server

   <span class="c1">#if tls_required is true, copy TLS files (using above example, the fully qualified path for these fils would be &quot;$RELEASE&quot;/chaincode/server/tls)</span>

   <span class="nb">exit</span> <span class="m">0</span>
<span class="k">fi</span>

<span class="nb">exit</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="writing-chaincode-to-run-as-an-external-service">
<h2>Writing chaincode to run as an external service<a class="headerlink" href="#writing-chaincode-to-run-as-an-external-service" title="Permalink to this headline">¶</a></h2>
<p>Currently, the chaincode as an external service model is supported by Go chaincode shim and Node.js chaincode shim.</p>
<div class="section" id="go">
<h3>Go<a class="headerlink" href="#go" title="Permalink to this headline">¶</a></h3>
<p>In Fabric v2.0, the Go shim API provides a <code class="docutils literal notranslate"><span class="pre">ChaincodeServer</span></code> type that developers should use to create a chaincode server.  The <code class="docutils literal notranslate"><span class="pre">Invoke</span></code> and <code class="docutils literal notranslate"><span class="pre">Query</span></code> APIs are unaffected. Developers should write to the <code class="docutils literal notranslate"><span class="pre">shim.ChaincodeServer</span></code> API, then build the chaincode and run it in the external environment of choice. Here is a simple sample chaincode program to illustrate the pattern:</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
        <span class="s">&quot;fmt&quot;</span>

        <span class="s">&quot;github.com/hyperledger/fabric-chaincode-go/shim&quot;</span>
        <span class="nx">pb</span> <span class="s">&quot;github.com/hyperledger/fabric-protos-go/peer&quot;</span>
<span class="p">)</span>

<span class="c1">// SimpleChaincode example simple Chaincode implementation</span>
<span class="kd">type</span> <span class="nx">SimpleChaincode</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">SimpleChaincode</span><span class="p">)</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
        <span class="c1">// init code</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">SimpleChaincode</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeStubInterface</span><span class="p">)</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span>
        <span class="c1">// invoke code</span>
<span class="p">}</span>

<span class="c1">//NOTE - parameters such as ccid and endpoint information are hard coded here for illustration. This can be passed in in a variety of standard ways</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
       <span class="c1">//The ccid is assigned to the chaincode on install (using the “peer lifecycle chaincode install &lt;package&gt;” command) for instance</span>
        <span class="nx">ccid</span> <span class="o">:=</span> <span class="s">&quot;mycc:fcbf8724572d42e859a7dd9a7cd8e2efb84058292017df6e3d89178b64e6c831&quot;</span>

        <span class="nx">server</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeServer</span><span class="p">{</span>
                        <span class="nx">CCID</span><span class="p">:</span> <span class="nx">ccid</span><span class="p">,</span>
                        <span class="nx">Address</span><span class="p">:</span> <span class="s">&quot;myhost:9999&quot;</span>
                        <span class="nx">CC</span><span class="p">:</span> <span class="nb">new</span><span class="p">(</span><span class="nx">SimpleChaincode</span><span class="p">),</span>
                        <span class="nx">TLSProps</span><span class="p">:</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">TLSProperties</span><span class="p">{</span>
                                <span class="nx">Disabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                        <span class="p">},</span>
                <span class="p">}</span>
        <span class="nx">err</span> <span class="o">:=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error starting Simple chaincode: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The key to running the chaincode as an external service is the use of <code class="docutils literal notranslate"><span class="pre">shim.ChaincodeServer</span></code>. This uses the new shim API <code class="docutils literal notranslate"><span class="pre">shim.ChaincodeServer</span></code> with the chaincode service properties described below:</p>
<ul class="simple">
<li><p><strong>CCID</strong> (string)- CCID should match chaincode’s package name on peer. This is the <code class="docutils literal notranslate"><span class="pre">CCID</span></code> associated with the installed chaincode as returned by the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">install</span> <span class="pre">&lt;package&gt;</span></code> CLI command. This can be obtained post-install using the “peer lifecycle chaincode queryinstalled” command.</p></li>
<li><p><strong>Address</strong> (string) - Address is the listen address of the chaincode server</p></li>
<li><p><strong>CC</strong> (Chaincode) -  CC is the chaincode that handles Init and Invoke</p></li>
<li><p><strong>TLSProps</strong> (TLSProperties) - TLSProps is the TLS properties passed to chaincode server</p></li>
<li><p><strong>KaOpts</strong> (keepalive.ServerParameters) -  KaOpts keepalive options, sensible defaults provided if nil</p></li>
</ul>
<p>Then build the chaincode as suitable to your Go environment.</p>
</div>
<div class="section" id="node-js">
<h3>Node.js<a class="headerlink" href="#node-js" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">fabric-shim</span></code> package for Node.js chaincode provides the <code class="docutils literal notranslate"><span class="pre">shim.server</span></code> API to run chaincode as an external service. If you are using contract APIs, you may want to use the <code class="docutils literal notranslate"><span class="pre">server</span></code> command provided by <code class="docutils literal notranslate"><span class="pre">fabric-chaincode-node</span></code> CLI to run a contract in the external service mode.</p>
<p>The following is a sample chaincode using <code class="docutils literal notranslate"><span class="pre">fabric-shim</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">shim</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fabric-shim&#39;</span><span class="p">);</span>

<span class="kd">class</span> <span class="nx">SimpleChaincode</span> <span class="k">extends</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeInterface</span> <span class="p">{</span>
        <span class="k">async</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// ... Init code</span>
        <span class="p">}</span>
        <span class="k">async</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// ... Invoke code</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="k">new</span> <span class="nx">SimpleChaincode</span><span class="p">(),</span> <span class="p">{</span>
        <span class="nx">ccid</span><span class="o">:</span> <span class="s2">&quot;mycc:fcbf8724572d42e859a7dd9a7cd8e2efb84058292017df6e3d89178b64e6c831&quot;</span><span class="p">,</span>
        <span class="nx">address</span><span class="o">:</span> <span class="s2">&quot;0.0.0.0:9999&quot;</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</pre></div>
</div>
<p>To run a chaincode with the <code class="docutils literal notranslate"><span class="pre">fabric-contract</span></code> API as an external service, simply use <code class="docutils literal notranslate"><span class="pre">fabric-chaincode-node</span> <span class="pre">server</span></code> instead of <code class="docutils literal notranslate"><span class="pre">fabric-chaincode-node</span> <span class="pre">start</span></code>. Here is a sample for <code class="docutils literal notranslate"><span class="pre">package.json</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;fabric-chaincode-node server&quot;</span>
        <span class="p">},</span>
        <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">fabric-chaincode-node</span> <span class="pre">server</span></code> is used, the following options should be set as either arguments or environment variables:</p>
<ul class="simple">
<li><p><strong>CORE_CHAINCODE_ID (–chaincode-id)</strong>: See <strong>CCID</strong> in the Go chaincode above.</p></li>
<li><p><strong>CORE_CHAINCODE_ADDRESS (–chaincode-address)</strong>: See <strong>Address</strong> in the Go chaincode above.</p></li>
</ul>
<p>If TLS is enabled, the following additional options are required:</p>
<ul class="simple">
<li><p><strong>CORE_CHAINCODE_TLS_CERT_FILE (–chaincode-tls-cert-file)</strong>: path to a certificate</p></li>
<li><p><strong>CORE_CHAINCODE_TLS_KEY_FILE (–chaincode-tls-key-file)</strong>: path to a private key</p></li>
</ul>
<p>When mutual TLS is enabled, <strong>CORE_CHAINCODE_TLS_CLIENT_CACERT_FILE (–chaincode-tls-client-cacert-file)</strong> option should be set to specify the path to the CA certificate for acceptable client certificates.</p>
</div>
</div>
<div class="section" id="deploying-the-chaincode">
<h2>Deploying the chaincode<a class="headerlink" href="#deploying-the-chaincode" title="Permalink to this headline">¶</a></h2>
<p>When the chaincode is ready for deployment, you can package the chaincode as explained in the <a class="reference external" href="#packaging-chaincode">Packaging chaincode</a> section and deploy the chaincode as explained in the <a class="reference external" href="./chaincode_lifecycle.html">Fabric chaincode lifecycle</a> concept topic.</p>
</div>
<div class="section" id="running-the-chaincode-as-an-external-service">
<h2>Running the chaincode as an external service<a class="headerlink" href="#running-the-chaincode-as-an-external-service" title="Permalink to this headline">¶</a></h2>
<p>Create the chaincode as specified in the <a class="reference external" href="#writing-chaincode-to-run-as-an-external-service">Writing chaincode to run as an external service</a> section. Run the built executable in your environment of choice, such as Kubernetes or directly as a process on the peer machine.</p>
<p>Using this chaincode as an external service model, installing the chaincode on each peer is no longer required. With the chaincode endpoint deployed to the peer instead and the chaincode running, you can continue the normal process of committing the
chaincode definition to the channel and invoking the chaincode.</p>
<!---
Licensed under Creative Commons Attribution 4.0 International License https://creativecommons.org/licenses/by/4.0/
--></div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="cc_launcher.html" title="previous page">External Builders and Launchers</a>
    <a class='right-next' id="next-link" href="error-handling.html" title="next page">Error handling</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
  </body>
</html>