
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transaction handlers &#8212; hyperledger-fabricdocs master documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Endorsement policies" href="endorsementpolicies.html" />
    <link rel="prev" title="Transaction context" href="transactioncontext.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <p class="title">hyperledger-fabricdocs</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../intro.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../whatsnew.html">Whatâ€™s new in Hyperledger Fabric v2.x</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href=""></a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../key_concepts.html">Key Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started.html">Getting Started - Install</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started_run_fabric.html">Getting Started - Run Fabric</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="developing_applications.html">Developing Applications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../deployment_guide_overview.html">Deploying a production network</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../ops_guide.html">Operations Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../upgrade.html">Upgrading to the latest release</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../command_ref.html">Commands Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../architecture.html">Architecture Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../Fabric-FAQ.html">Frequently Asked Questions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../CONTRIBUTING.html">Contributions Welcome!</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../glossary.html">Glossary</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../releases.html">Releases</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../questions.html">Still Have Questions?</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../status.html">Status</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="scenario.html">The scenario</a>
                </li>
            
          
            
                <li class="">
                    <a href="analysis.html">Analysis</a>
                </li>
            
          
            
                <li class="">
                    <a href="architecture.html">Process and Data Design</a>
                </li>
            
          
            
                <li class="">
                    <a href="smartcontract.html">Smart Contract Processing</a>
                </li>
            
          
            
                <li class="">
                    <a href="application.html">Application</a>
                </li>
            
          
            
  
                <li class="active">
                    <a href="designelements.html">Application design elements</a>
                    <ul>
                    
                        <li class="">
                            <a href="contractname.html">Contract names</a>
                        </li>
                    
                        <li class="">
                            <a href="chaincodenamespace.html">Chaincode namespace</a>
                        </li>
                    
                        <li class="">
                            <a href="transactioncontext.html">Transaction context</a>
                        </li>
                    
                        <li class="active">
                            <a href="">Transaction handlers</a>
                        </li>
                    
                        <li class="">
                            <a href="endorsementpolicies.html">Endorsement policies</a>
                        </li>
                    
                        <li class="">
                            <a href="connectionprofile.html">Connection Profile</a>
                        </li>
                    
                        <li class="">
                            <a href="connectionoptions.html">Connection Options</a>
                        </li>
                    
                        <li class="">
                            <a href="wallet.html">Wallet</a>
                        </li>
                    
                        <li class="">
                            <a href="gateway.html">Gateway</a>
                        </li>
                    
                    </ul>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#types-of-handler" class="nav-link">Types of handler</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#defining-a-handler" class="nav-link">Defining a handler</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#handler-processing" class="nav-link">Handler processing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#multiple-handlers" class="nav-link">Multiple handlers</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="transaction-handlers">
<h1>Transaction handlers<a class="headerlink" href="#transaction-handlers" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Audience</strong>: Architects, Application and smart contract developers</p>
<p>Transaction handlers allow smart contract developers to define common processing
at key points during the interaction between an application and a smart
contract. Transaction handlers are optional but, if defined, they will receive
control before or after every transaction in a smart contract is invoked. There
is also a specific handler which receives control when a request is made to
invoke a transaction not defined in a smart contract.</p>
<p>Hereâ€™s an example of transaction handlers for the <a class="reference external" href="./smartcontract.html">commercial paper smart
contract sample</a>:</p>
<p><img alt="develop.transactionhandler" src="../_images/develop.diagram.2.png" /></p>
<p><em>Before, After and Unknown transaction handlers. In this example,
<code class="docutils literal notranslate"><span class="pre">beforeTransaction()</span></code> is called before the <strong>issue</strong>, <strong>buy</strong> and <strong>redeem</strong>
transactions. <code class="docutils literal notranslate"><span class="pre">afterTransaction()</span></code> is called after the <strong>issue</strong>, <strong>buy</strong> and
<strong>redeem</strong> transactions. <code class="docutils literal notranslate"><span class="pre">unknownTransaction()</span></code> is only called if a request is
made to invoke a transaction not defined in the smart contract.  (The diagram is
simplified by not repeating <code class="docutils literal notranslate"><span class="pre">beforeTransaction</span></code> and <code class="docutils literal notranslate"><span class="pre">afterTransaction</span></code> boxes for
each transaction.)</em></p>
<div class="section" id="types-of-handler">
<h2>Types of handler<a class="headerlink" href="#types-of-handler" title="Permalink to this headline">Â¶</a></h2>
<p>There are three types of transaction handlers which cover different aspects
of the interaction between an application and a smart contract:</p>
<ul class="simple">
<li><p><strong>Before handler</strong>: is called before every smart contract transaction is
invoked. The handler will usually modify the transaction context to be used
by the transaction. The handler has access to the full range of Fabric APIs;
for example, it can issue <code class="docutils literal notranslate"><span class="pre">getState()</span></code> and <code class="docutils literal notranslate"><span class="pre">putState()</span></code>.</p></li>
<li><p><strong>After handler</strong>: is called after every smart contract transaction is
invoked. The handler will usually perform post-processing common to all
transactions, and also has full access to the Fabric APIs.</p></li>
<li><p><strong>Unknown handler</strong>: is called if an attempt is made to invoke a transaction
that is not defined in a smart contract. Typically, the handler will record
the failure for subsequent processing by an administrator. The handler has
full access to the Fabric APIs.</p></li>
</ul>
<p>Defining a transaction handler is optional; a smart contract will perform
correctly without handlers being defined. A smart contract can define at most
one handler of each type.</p>
</div>
<div class="section" id="defining-a-handler">
<h2>Defining a handler<a class="headerlink" href="#defining-a-handler" title="Permalink to this headline">Â¶</a></h2>
<p>Transaction handlers are added to the smart contract as methods with well
defined names.  Hereâ€™s an example which adds a handler of each type:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="nx">CommercialPaperContract</span> <span class="k">extends</span> <span class="nx">Contract</span> <span class="p">{</span>

    <span class="p">...</span>

    <span class="k">async</span> <span class="nx">beforeTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Write the transaction ID as an informational to the console</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stub</span><span class="p">.</span><span class="nx">getTxID</span><span class="p">());</span>
    <span class="p">};</span>

    <span class="k">async</span> <span class="nx">afterTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This handler interacts with the ledger</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stub</span><span class="p">.</span><span class="nx">cpList</span><span class="p">.</span><span class="nx">putState</span><span class="p">(...);</span>
    <span class="p">};</span>

    <span class="k">async</span> <span class="nx">unknownTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This handler throws an exception</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Unknown transaction function&#39;</span><span class="p">);</span>
    <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The form of a transaction handler definition is the similar for all handler
types, but notice how the <code class="docutils literal notranslate"><span class="pre">afterTransaction(ctx,</span> <span class="pre">result)</span></code> also receives any
result returned by the transaction. The <a class="reference external" href="https://hyperledger.github.io/fabric-chaincode-node/%7BBRANCH%7D/api/fabric-contract-api.Contract.html">API
documentation</a>
shows you the exact form of these handlers.</p>
</div>
<div class="section" id="handler-processing">
<h2>Handler processing<a class="headerlink" href="#handler-processing" title="Permalink to this headline">Â¶</a></h2>
<p>Once a handler has been added to the smart contract, it will be invoked during
transaction processing. During processing, the handler receives <code class="docutils literal notranslate"><span class="pre">ctx</span></code>, the
<a class="reference external" href="./transationcontext">transaction context</a>, performs some processing, and
returns control as it completes. Processing continues as follows:</p>
<ul class="simple">
<li><p><strong>Before handler</strong>: If the handler completes successfully, the transaction is
called with the updated context. If the handler throws an exception, then the
transaction is not called and the smart contract fails with the exception
error message.</p></li>
<li><p><strong>After handler</strong>: If the handler completes successfully, then the smart
contract completes as determined by the invoked transaction. If the handler
throws an exception, then the transaction fails with the exception error
message.</p></li>
<li><p><strong>Unknown handler</strong>: The handler should complete by throwing an exception with
the required error message. If an <strong>Unknown handler</strong> is not specified, or an
exception is not thrown by it, there is sensible default processing; the smart
contract will fail with an <strong>unknown transaction</strong> error message.</p></li>
</ul>
<p>If the handler requires access to the function and parameters, then it is easy to do this:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="nx">beforeTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Retrieve details of the transaction</span>
    <span class="kd">let</span> <span class="nx">txnDetails</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">stub</span><span class="p">.</span><span class="nx">getFunctionAndParameters</span><span class="p">();</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="sb">`Calling function: </span><span class="si">${</span><span class="nx">txnDetails</span><span class="p">.</span><span class="nx">fcn</span><span class="si">}</span><span class="sb"> `</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="sb">`Function arguments : %j </span><span class="si">${</span><span class="nx">stub</span><span class="p">.</span><span class="nx">getArgs</span><span class="p">()</span><span class="si">}</span><span class="sb"> ``);</span>
<span class="sb">}</span>
</pre></div>
</div>
<p>See how this handler uses the utility API <code class="docutils literal notranslate"><span class="pre">getFunctionAndParameters</span></code> via the
<a class="reference external" href="./transactioncontext.html#stub">transaction context</a>.</p>
</div>
<div class="section" id="multiple-handlers">
<h2>Multiple handlers<a class="headerlink" href="#multiple-handlers" title="Permalink to this headline">Â¶</a></h2>
<p>It is only possible to define at most one handler of each type for a smart
contract. If a smart contract needs to invoke multiple functions during before,
after or unknown handling, it should coordinate this from within the appropriate
function.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="transactioncontext.html" title="previous page">Transaction context</a>
    <a class='right-next' id="next-link" href="endorsementpolicies.html" title="next page">Endorsement policies</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
  </body>
</html>