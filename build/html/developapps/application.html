
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Application &#8212; hyperledger-fabricdocs master documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Application design elements" href="designelements.html" />
    <link rel="prev" title="Smart Contract Processing" href="smartcontract.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <p class="title">hyperledger-fabricdocs</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../intro.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../whatsnew.html">What’s new in Hyperledger Fabric v2.x</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href=""></a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../key_concepts.html">Key Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started.html">Getting Started - Install</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started_run_fabric.html">Getting Started - Run Fabric</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="developing_applications.html">Developing Applications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../deployment_guide_overview.html">Deploying a production network</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../ops_guide.html">Operations Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../upgrade.html">Upgrading to the latest release</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../command_ref.html">Commands Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../architecture.html">Architecture Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../Fabric-FAQ.html">Frequently Asked Questions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../CONTRIBUTING.html">Contributions Welcome!</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../glossary.html">Glossary</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../releases.html">Releases</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../questions.html">Still Have Questions?</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../status.html">Status</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="scenario.html">The scenario</a>
                </li>
            
          
            
                <li class="">
                    <a href="analysis.html">Analysis</a>
                </li>
            
          
            
                <li class="">
                    <a href="architecture.html">Process and Data Design</a>
                </li>
            
          
            
                <li class="">
                    <a href="smartcontract.html">Smart Contract Processing</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Application</a>
                </li>
            
          
            
                <li class="">
                    <a href="designelements.html">Application design elements</a>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#basic-flow" class="nav-link">Basic Flow</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#wallet" class="nav-link">Wallet</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#gateway" class="nav-link">Gateway</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#network-channel" class="nav-link">Network channel</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#construct-request" class="nav-link">Construct request</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#submit-transaction" class="nav-link">Submit transaction</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#process-response" class="nav-link">Process response</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="application">
<h1>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h1>
<p><strong>Audience</strong>: Architects, Application and smart contract developers</p>
<p>An application can interact with a blockchain network by submitting transactions
to a ledger or querying ledger content. This topic covers the mechanics of how
an application does this; in our scenario, organizations access PaperNet using
applications which invoke <strong>issue</strong>, <strong>buy</strong> and <strong>redeem</strong> transactions
defined in a commercial paper smart contract. Even though MagnetoCorp’s
application to issue a commercial paper is basic, it covers all the major points
of understanding.</p>
<p>In this topic, we’re going to cover:</p>
<ul class="simple">
<li><p><a class="reference external" href="#basic-flow">The application flow to invoke a smart contract</a></p></li>
<li><p><a class="reference external" href="#wallet">How an application uses a wallet and identity</a></p></li>
<li><p><a class="reference external" href="#gateway">How an application connects using a gateway</a></p></li>
<li><p><a class="reference external" href="#network-channel">How to access a particular network</a></p></li>
<li><p><a class="reference external" href="#construct-request">How to construct a transaction request</a></p></li>
<li><p><a class="reference external" href="#submit-transaction">How to submit a transaction</a></p></li>
<li><p><a class="reference external" href="#process-response">How to process a transaction response</a></p></li>
</ul>
<p>To help your understanding, we’ll make reference to the commercial paper sample
application provided with Hyperledger Fabric. You can <a class="reference external" href="../install.html">download
it</a> and <a class="reference external" href="../tutorial/commercial_paper.html">run it locally</a>. It
is written in both JavaScript and Java, but the logic is quite language independent, so you’ll
easily be able to see what’s going on! (The sample will become available for  Go as well.)</p>
<div class="section" id="basic-flow">
<h2>Basic Flow<a class="headerlink" href="#basic-flow" title="Permalink to this headline">¶</a></h2>
<p>An application interacts with a blockchain network using the Fabric SDK. Here’s
a simplified diagram of how an application invokes a commercial paper smart
contract:</p>
<p><img alt="develop.application" src="../_images/develop.diagram.3.png" /> <em>A PaperNet application invokes
the commercial paper smart contract to submit an issue transaction request.</em></p>
<p>An application has to follow six basic steps to submit a transaction:</p>
<ul class="simple">
<li><p>Select an identity from a wallet</p></li>
<li><p>Connect to a gateway</p></li>
<li><p>Access the desired network</p></li>
<li><p>Construct a transaction request for a smart contract</p></li>
<li><p>Submit the transaction to the network</p></li>
<li><p>Process the response</p></li>
</ul>
<p>You’re going to see how a typical application performs these six steps using the
Fabric SDK. You’ll find the application code in the <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> file. <a class="reference external" href="https://github.com/hyperledger/fabric-samples/blob/%7BBRANCH%7D/commercial-paper/organization/magnetocorp/application/issue.js">View
it</a>
in your browser, or open it in your favourite editor if you’ve downloaded it.
Spend a few moments looking at the overall structure of the application; even
with comments and spacing, it’s only 100 lines of code!</p>
</div>
<div class="section" id="wallet">
<h2>Wallet<a class="headerlink" href="#wallet" title="Permalink to this headline">¶</a></h2>
<p>Towards the top of <code class="docutils literal notranslate"><span class="pre">issue.js</span></code>, you’ll see two Fabric classes are brought
into scope:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="p">{</span> <span class="nx">Wallets</span><span class="p">,</span> <span class="nx">Gateway</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fabric-network&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can read about the <code class="docutils literal notranslate"><span class="pre">fabric-network</span></code> classes in the
<a class="reference external" href="https://hyperledger.github.io/fabric-sdk-node/%7BBRANCH%7D/module-fabric-network.html">node SDK documentation</a>, but for
now, let’s see how they are used to connect MagnetoCorp’s application to
PaperNet. The application uses the Fabric <strong>Wallet</strong> class as follows:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Wallets</span><span class="p">.</span><span class="nx">newFileSystemWallet</span><span class="p">(</span><span class="s1">&#39;../identity/user/isabella/wallet&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>See how <code class="docutils literal notranslate"><span class="pre">wallet</span></code> locates a <a class="reference external" href="./wallet.html">wallet</a> in the local filesystem. The
identity retrieved from the wallet is clearly for a user called Isabella, who is
using the <code class="docutils literal notranslate"><span class="pre">issue</span></code> application. The wallet holds a set of identities – X.509
digital certificates – which can be used to access PaperNet or any other Fabric
network. If you run the tutorial, and look in this directory, you’ll see the
identity credentials for Isabella.</p>
<p>Think of a <a class="reference external" href="./wallet.html">wallet</a> holding the digital equivalents of your
government ID, driving license or ATM card. The X.509 digital certificates
within it will associate the holder with a organization, thereby entitling them
to rights in a network channel. For example, <code class="docutils literal notranslate"><span class="pre">Isabella</span></code> might be an
administrator in MagnetoCorp, and this could give her more privileges than a
different user – <code class="docutils literal notranslate"><span class="pre">Balaji</span></code> from DigiBank.  Moreover, a smart contract can
retrieve this identity during smart contract processing using the <a class="reference external" href="./transactioncontext.html">transaction
context</a>.</p>
<p>Note also that wallets don’t hold any form of cash or tokens – they hold
identities.</p>
</div>
<div class="section" id="gateway">
<h2>Gateway<a class="headerlink" href="#gateway" title="Permalink to this headline">¶</a></h2>
<p>The second key class is a Fabric <strong>Gateway</strong>. Most importantly, a
<a class="reference external" href="./gateway.html">gateway</a> identifies one or more peers that provide access to a
network – in our case, PaperNet. See how <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> connects to its gateway:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="nx">gateway</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">connectionProfile</span><span class="p">,</span> <span class="nx">connectionOptions</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gateway.connect()</span></code> has two important parameters:</p>
<ul class="simple">
<li><p><strong>connectionProfile</strong>: the file system location of a
<a class="reference external" href="./connectionprofile.html">connection profile</a> that identifies
a set of peers as a gateway to PaperNet</p></li>
<li><p><strong>connectionOptions</strong>: a set of options used to control how <code class="docutils literal notranslate"><span class="pre">issue.js</span></code>
interacts with PaperNet</p></li>
</ul>
<p>See how the client application uses a gateway to insulate itself from the
network topology, which might change. The gateway takes care of sending the
transaction proposal to the right peer nodes in the network using the
<a class="reference external" href="./connectionprofile.html">connection profile</a> and <a class="reference external" href="./connectionoptions.html">connection
options</a>.</p>
<p>Spend a few moments examining the connection
<a class="reference external" href="https://github.com/hyperledger/fabric-samples/blob/%7BBRANCH%7D/commercial-paper/organization/magnetocorp/gateway/networkConnection.yaml">profile</a>
<code class="docutils literal notranslate"><span class="pre">./gateway/connectionProfile.yaml</span></code>. It uses
<a class="reference external" href="http://yaml.org/spec/1.2/spec.html#Preview">YAML</a>, making it easy to read.</p>
<p>It was loaded and converted into a JSON object:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">connectionProfile</span> <span class="o">=</span> <span class="nx">yaml</span><span class="p">.</span><span class="nx">safeLoad</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;./gateway/connectionProfile.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Right now, we’re only interested in the <code class="docutils literal notranslate"><span class="pre">channels:</span></code> and <code class="docutils literal notranslate"><span class="pre">peers:</span></code> sections of the
profile: (We’ve modified the details slightly to better explain what’s
happening.)</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">channels</span><span class="p">:</span>
  <span class="nt">papernet</span><span class="p">:</span>
    <span class="nt">peers</span><span class="p">:</span>
      <span class="nt">peer1.magnetocorp.com</span><span class="p">:</span>
        <span class="nt">endorsingPeer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">eventSource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

      <span class="nt">peer2.digibank.com</span><span class="p">:</span>
        <span class="nt">endorsingPeer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">eventSource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">peers</span><span class="p">:</span>
  <span class="nt">peer1.magnetocorp.com</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grpcs://localhost:7051</span>
    <span class="nt">grpcOptions</span><span class="p">:</span>
      <span class="nt">ssl-target-name-override</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">peer1.magnetocorp.com</span>
      <span class="nt">request-timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">120</span>
    <span class="nt">tlsCACerts</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">certificates/magnetocorp/magnetocorp.com-cert.pem</span>

  <span class="nt">peer2.digibank.com</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grpcs://localhost:8051</span>
    <span class="nt">grpcOptions</span><span class="p">:</span>
      <span class="nt">ssl-target-name-override</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">peer1.digibank.com</span>
    <span class="nt">tlsCACerts</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">certificates/digibank/digibank.com-cert.pem</span>
</pre></div>
</div>
<p>See how <code class="docutils literal notranslate"><span class="pre">channel:</span></code> identifies the <code class="docutils literal notranslate"><span class="pre">PaperNet:</span></code> network channel, and two of its
peers. MagnetoCorp has <code class="docutils literal notranslate"><span class="pre">peer1.magenetocorp.com</span></code> and DigiBank has
<code class="docutils literal notranslate"><span class="pre">peer2.digibank.com</span></code>, and both have the role of endorsing peers. Link to these
peers via the <code class="docutils literal notranslate"><span class="pre">peers:</span></code> key, which contains details about how to connect to them,
including their respective network addresses.</p>
<p>The connection profile contains a lot of information – not just peers – but
network channels, network orderers, organizations, and CAs, so don’t worry if
you don’t understand all of it!</p>
<p>Let’s now turn our attention to the <code class="docutils literal notranslate"><span class="pre">connectionOptions</span></code> object:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">connectionOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">identity</span><span class="o">:</span> <span class="nx">userName</span><span class="p">,</span>
    <span class="nx">wallet</span><span class="o">:</span> <span class="nx">wallet</span><span class="p">,</span>
    <span class="nx">discovery</span><span class="o">:</span> <span class="p">{</span> <span class="nx">enabled</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">asLocalhost</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>See how it specifies that identity, <code class="docutils literal notranslate"><span class="pre">userName</span></code>, and wallet, <code class="docutils literal notranslate"><span class="pre">wallet</span></code>, should be
used to connect to a gateway. These were assigned values earlier in the code.</p>
<p>There are other <a class="reference external" href="./connectionoptions.html">connection options</a> which an
application could use to instruct the SDK to act intelligently on its behalf.
For example:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">connectionOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">identity</span><span class="o">:</span> <span class="nx">userName</span><span class="p">,</span>
  <span class="nx">wallet</span><span class="o">:</span> <span class="nx">wallet</span><span class="p">,</span>
  <span class="nx">eventHandlerOptions</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">commitTimeout</span><span class="o">:</span> <span class="mf">100</span><span class="p">,</span>
    <span class="nx">strategy</span><span class="o">:</span> <span class="nx">EventStrategies</span><span class="p">.</span><span class="nx">MSPID_SCOPE_ANYFORTX</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">commitTimeout</span></code> tells the SDK to wait 100 seconds to hear whether a
transaction has been committed. And <code class="docutils literal notranslate"><span class="pre">strategy:</span> <span class="pre">EventStrategies.MSPID_SCOPE_ANYFORTX</span></code> specifies that the SDK can notify an
application after a single MagnetoCorp peer has confirmed the transaction, in
contrast to <code class="docutils literal notranslate"><span class="pre">strategy:</span> <span class="pre">EventStrategies.NETWORK_SCOPE_ALLFORTX</span></code> which requires
that all peers from MagnetoCorp and DigiBank to confirm the transaction.</p>
<p>If you’d like to, <a class="reference external" href="./connectionoptions.html">read more</a> about how connection
options allow applications to specify goal-oriented behaviour without having to
worry about how it is achieved.</p>
</div>
<div class="section" id="network-channel">
<h2>Network channel<a class="headerlink" href="#network-channel" title="Permalink to this headline">¶</a></h2>
<p>The peers defined in the gateway <code class="docutils literal notranslate"><span class="pre">connectionProfile.yaml</span></code> provide
<code class="docutils literal notranslate"><span class="pre">issue.js</span></code> with access to PaperNet. Because these peers can be joined to
multiple network channels, the gateway actually provides the application with
access to multiple network channels!</p>
<p>See how the application selects a particular channel:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">network</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">gateway</span><span class="p">.</span><span class="nx">getNetwork</span><span class="p">(</span><span class="s1">&#39;PaperNet&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>From this point onwards, <code class="docutils literal notranslate"><span class="pre">network</span></code> will provide access to PaperNet.  Moreover,
if the application wanted to access another network, <code class="docutils literal notranslate"><span class="pre">BondNet</span></code>, at the same
time, it is easy:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">network2</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">gateway</span><span class="p">.</span><span class="nx">getNetwork</span><span class="p">(</span><span class="s1">&#39;BondNet&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now our application has access to a second network, <code class="docutils literal notranslate"><span class="pre">BondNet</span></code>, simultaneously
with <code class="docutils literal notranslate"><span class="pre">PaperNet</span></code>!</p>
<p>We can see here a powerful feature of Hyperledger Fabric – applications can
participate in a <strong>network of networks</strong>, by connecting to multiple gateway
peers, each of which is joined to multiple network channels. Applications will
have different rights in different channels according to their wallet identity
provided in <code class="docutils literal notranslate"><span class="pre">gateway.connect()</span></code>.</p>
</div>
<div class="section" id="construct-request">
<h2>Construct request<a class="headerlink" href="#construct-request" title="Permalink to this headline">¶</a></h2>
<p>The application is now ready to <strong>issue</strong> a commercial paper.  To do this, it’s
going to use <code class="docutils literal notranslate"><span class="pre">CommercialPaperContract</span></code> and again, its fairly straightforward to
access this smart contract:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">network</span><span class="p">.</span><span class="nx">getContract</span><span class="p">(</span><span class="s1">&#39;papercontract&#39;</span><span class="p">,</span> <span class="s1">&#39;org.papernet.commercialpaper&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note how the application provides a name – <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> – and an explicit
contract name: <code class="docutils literal notranslate"><span class="pre">org.papernet.commercialpaper</span></code>! We see how a <a class="reference external" href="./contractname.html">contract
name</a> picks out one contract from the <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code>
chaincode file that contains many contracts. In PaperNet, <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code> was
installed and deployed to the channel with the name <code class="docutils literal notranslate"><span class="pre">papercontract</span></code>, and if you’re
interested, read <a class="reference external" href="../chaincode_lifecycle.html">how</a> to deploy a chaincode containing
multiple smart contracts.</p>
<p>If our application simultaneously required access to another contract in
PaperNet or BondNet this would be easy:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">euroContract</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">network</span><span class="p">.</span><span class="nx">getContract</span><span class="p">(</span><span class="s1">&#39;EuroCommercialPaperContract&#39;</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">bondContract</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">network2</span><span class="p">.</span><span class="nx">getContract</span><span class="p">(</span><span class="s1">&#39;BondContract&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>In these examples, note how we didn’t use a qualifying contract name – we have
only one smart contract per file, and <code class="docutils literal notranslate"><span class="pre">getContract()</span></code> will use the first
contract it finds.</p>
<p>Recall the transaction MagnetoCorp uses to issue its first commercial paper:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Txn</span> <span class="o">=</span> <span class="n">issue</span>
<span class="n">Issuer</span> <span class="o">=</span> <span class="n">MagnetoCorp</span>
<span class="n">Paper</span> <span class="o">=</span> <span class="mi">00001</span>
<span class="n">Issue</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">31</span> <span class="n">May</span> <span class="mi">2020</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">EST</span>
<span class="n">Maturity</span> <span class="n">date</span> <span class="o">=</span> <span class="mi">30</span> <span class="n">November</span> <span class="mi">2020</span>
<span class="n">Face</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="n">M</span> <span class="n">USD</span>
</pre></div>
</div>
<p>Let’s now submit this transaction to PaperNet!</p>
</div>
<div class="section" id="submit-transaction">
<h2>Submit transaction<a class="headerlink" href="#submit-transaction" title="Permalink to this headline">¶</a></h2>
<p>Submitting a transaction is a single method call to the SDK:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">issueResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">submitTransaction</span><span class="p">(</span><span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;MagnetoCorp&#39;</span><span class="p">,</span> <span class="s1">&#39;00001&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;5000000&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>See how the <code class="docutils literal notranslate"><span class="pre">submitTransaction()</span></code> parameters match those of the transaction
request.  It’s these values that will be passed to the <code class="docutils literal notranslate"><span class="pre">issue()</span></code> method in the
smart contract, and used to create a new commercial paper.  Recall its
signature:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="nx">issue</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">issuer</span><span class="p">,</span> <span class="nx">paperNumber</span><span class="p">,</span> <span class="nx">issueDateTime</span><span class="p">,</span> <span class="nx">maturityDateTime</span><span class="p">,</span> <span class="nx">faceValue</span><span class="p">)</span> <span class="p">{...}</span>
</pre></div>
</div>
<p>It might appear that a smart contract receives control shortly after the
application issues <code class="docutils literal notranslate"><span class="pre">submitTransaction()</span></code>, but that’s not the case. Under the
covers, the SDK uses the <code class="docutils literal notranslate"><span class="pre">connectionOptions</span></code> and <code class="docutils literal notranslate"><span class="pre">connectionProfile</span></code> details to
send the transaction proposal to the right peers in the network, where it can
get the required endorsements. But the application doesn’t need to worry about
any of this – it just issues <code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> and the SDK takes care of it
all!</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">submitTransaction</span></code> API includes a process for listening for
transaction commits. Listening for commits is required because without it,
you will not know whether your transaction has successfully been orderered,
validated, and committed to the ledger.</p>
<p>Let’s now turn our attention to how the application handles the response!</p>
</div>
<div class="section" id="process-response">
<h2>Process response<a class="headerlink" href="#process-response" title="Permalink to this headline">¶</a></h2>
<p>Recall from <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code> how the <strong>issue</strong> transaction returns a
commercial paper response:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">toBuffer</span><span class="p">();</span>
</pre></div>
</div>
<p>You’ll notice a slight quirk – the new <code class="docutils literal notranslate"><span class="pre">paper</span></code> needs to be converted to a
buffer before it is returned to the application. Notice how <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> uses the
class method <code class="docutils literal notranslate"><span class="pre">CommercialPaper.fromBuffer()</span></code> to rehydrate the response buffer as
a commercial paper:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">paper</span> <span class="o">=</span> <span class="nx">CommercialPaper</span><span class="p">.</span><span class="nx">fromBuffer</span><span class="p">(</span><span class="nx">issueResponse</span><span class="p">);</span>
</pre></div>
</div>
<p>This allows <code class="docutils literal notranslate"><span class="pre">paper</span></code> to be used in a natural way in a descriptive completion
message:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">paper</span><span class="p">.</span><span class="nx">issuer</span><span class="si">}</span><span class="sb"> commercial paper : </span><span class="si">${</span><span class="nx">paper</span><span class="p">.</span><span class="nx">paperNumber</span><span class="si">}</span><span class="sb"> successfully issued for value </span><span class="si">${</span><span class="nx">paper</span><span class="p">.</span><span class="nx">faceValue</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</pre></div>
</div>
<p>See how the same <code class="docutils literal notranslate"><span class="pre">paper</span></code> class has been used in both the application and smart
contract – if you structure your code like this, it’ll really help readability
and reuse.</p>
<p>As with the transaction proposal, it might appear that the application receives
control soon after the smart contract completes, but that’s not the case. Under
the covers, the SDK manages the entire consensus process, and notifies the
application when it is complete according to the <code class="docutils literal notranslate"><span class="pre">strategy</span></code> connectionOption. If
you’re interested in what the SDK does under the covers, read the detailed
<a class="reference external" href="../txflow.html">transaction flow</a>.</p>
<p>That’s it! In this topic you’ve understood how to call a smart contract from a
sample application by examining how MagnetoCorp’s application issues a new
commercial paper in PaperNet. Now examine the key ledger and smart contract data
structures are designed by in the <a class="reference external" href="./architecture.html">architecture topic</a> behind
them.</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="smartcontract.html" title="previous page">Smart Contract Processing</a>
    <a class='right-next' id="next-link" href="designelements.html" title="next page">Application design elements</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
  </body>
</html>