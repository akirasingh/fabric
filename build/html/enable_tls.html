
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Securing Communication With Transport Layer Security (TLS) &#8212; hyperledger-fabricdocs master documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuring and operating a Raft ordering service" href="raft_configuration.html" />
    <link rel="prev" title="Logging Control" href="logging-control.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="index.html">
    
      <p class="title">hyperledger-fabricdocs</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="intro.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="whatsnew.html">Whatâ€™s new in Hyperledger Fabric v2.x</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href=""></a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="key_concepts.html">Key Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started.html">Getting Started - Install</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started_run_fabric.html">Getting Started - Run Fabric</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="developapps/developing_applications.html">Developing Applications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="deployment_guide_overview.html">Deploying a production network</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="ops_guide.html">Operations Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="upgrade.html">Upgrading to the latest release</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="command_ref.html">Commands Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="architecture.html">Architecture Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="Fabric-FAQ.html">Frequently Asked Questions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="CONTRIBUTING.html">Contributions Welcome!</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="glossary.html">Glossary</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="releases.html">Releases</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="questions.html">Still Have Questions?</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="status.html">Status</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="msp.html">Membership Service Providers (MSP)</a>
                </li>
            
          
            
                <li class="">
                    <a href="peer_ledger_snapshot.html">Taking ledger snapshots and using them to join channels</a>
                </li>
            
          
            
                <li class="">
                    <a href="hsm.html">Using a Hardware Security Module (HSM)</a>
                </li>
            
          
            
                <li class="">
                    <a href="configtx.html">Channel Configuration (configtx)</a>
                </li>
            
          
            
                <li class="">
                    <a href="endorsement-policies.html">Endorsement policies</a>
                </li>
            
          
            
                <li class="">
                    <a href="pluggable_endorsement_and_validation.html">Pluggable transaction endorsement and validation</a>
                </li>
            
          
            
                <li class="">
                    <a href="access_control.html">Access Control Lists (ACL)</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemix.html">MSP Implementation with Identity Mixer</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemixgen.html">Identity Mixer MSP configuration generator (idemixgen)</a>
                </li>
            
          
            
                <li class="">
                    <a href="operations_service.html">The Operations Service</a>
                </li>
            
          
            
                <li class="">
                    <a href="metrics_reference.html">Metrics Reference</a>
                </li>
            
          
            
                <li class="">
                    <a href="cc_launcher.html">External Builders and Launchers</a>
                </li>
            
          
            
                <li class="">
                    <a href="cc_service.html">Chaincode as an external service</a>
                </li>
            
          
            
                <li class="">
                    <a href="error-handling.html">Error handling</a>
                </li>
            
          
            
                <li class="">
                    <a href="logging-control.html">Logging Control</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Securing Communication With Transport Layer Security (TLS)</a>
                </li>
            
          
            
                <li class="">
                    <a href="raft_configuration.html">Configuring and operating a Raft ordering service</a>
                </li>
            
          
            
                <li class="">
                    <a href="kafka_raft_migration.html">Migrating from Kafka to Raft</a>
                </li>
            
          
            
                <li class="">
                    <a href="kafka.html">Bringing up a Kafka-based Ordering Service</a>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#configuring-tls-for-peers-nodes" class="nav-link">Configuring TLS for peers nodes</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#configuring-tls-for-orderer-nodes" class="nav-link">Configuring TLS for orderer nodes</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#configuring-tls-for-the-peer-cli" class="nav-link">Configuring TLS for the peer CLI</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#debugging-tls-issues" class="nav-link">Debugging TLS issues</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="securing-communication-with-transport-layer-security-tls">
<h1>Securing Communication With Transport Layer Security (TLS)<a class="headerlink" href="#securing-communication-with-transport-layer-security-tls" title="Permalink to this headline">Â¶</a></h1>
<p>Fabric supports for secure communication between nodes using TLS.  TLS communication
can use both one-way (server only) and two-way (server and client) authentication.</p>
<div class="section" id="configuring-tls-for-peers-nodes">
<h2>Configuring TLS for peers nodes<a class="headerlink" href="#configuring-tls-for-peers-nodes" title="Permalink to this headline">Â¶</a></h2>
<p>A peer node is both a TLS server and a TLS client. It is the former when another peer
node, application, or the CLI makes a connection to it and the latter when it makes
a connection to another peer node or orderer.</p>
<p>To enable TLS on a peer node set the following peer configuration properties:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">peer.tls.enabled</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peer.tls.cert.file</span></code> = fully qualified path of the file that contains the TLS server
certificate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peer.tls.key.file</span></code> = fully qualified path of the file that contains the TLS server
private key</p></li>
</ul>
</div></blockquote>
<p>By default, TLS client authentication is turned off when TLS is enabled on a peer node.
This means that the peer node will not verify the certificate of a client (another peer
node, application, or the CLI) during a TLS handshake. To enable TLS client authentication
on a peer node, set the peer configuration property <code class="docutils literal notranslate"><span class="pre">peer.tls.clientAuthRequired</span></code> to
<code class="docutils literal notranslate"><span class="pre">true</span></code> and set the <code class="docutils literal notranslate"><span class="pre">peer.tls.clientRootCAs.files</span></code> property to the CA chain file(s) that
contain(s) the CA certificate chain(s) that issued TLS certificates for your organizationâ€™s
clients.</p>
<p>By default, a peer node will use the same certificate and private key pair when acting as a
TLS server and client.  To use a different certificate and private key pair for the client
side, set the <code class="docutils literal notranslate"><span class="pre">peer.tls.clientCert.file</span></code> and <code class="docutils literal notranslate"><span class="pre">peer.tls.clientKey.file</span></code> configuration
properties to the fully qualified path of the client certificate and key file,
respectively.</p>
<p>TLS with client authentication can also be enabled by setting the following environment
variables:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_ENABLED</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CERT_FILE</span></code> = fully qualified path of the server certificate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_KEY_FILE</span></code> = fully qualified path of the server private key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CLIENTAUTHREQUIRED</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CLIENTROOTCAS_FILES</span></code> = fully qualified path of the CA chain file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CLIENTCERT_FILE</span></code> = fully qualified path of the client certificate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CLIENTKEY_FILE</span></code> = fully qualified path of the client key</p></li>
</ul>
</div></blockquote>
<p>When client authentication is enabled on a peer node, a client is required to send its
certificate during a TLS handshake. If the client does not send its certificate, the
handshake will fail and the peer will close the connection.</p>
<p>When a peer joins a channel, root CA certificate chains of the channel members are
read from the config block of the channel and are added to the TLS server and client
root CAs data structure. So, peer to peer communication, peer to orderer communication
should work seamlessly. However, if needed, you can add additional root CA certificates
by setting <code class="docutils literal notranslate"><span class="pre">peer.tls.rootcert.file</span></code> and <code class="docutils literal notranslate"><span class="pre">peer.tls.clientRootCAs.files</span></code>.</p>
</div>
<div class="section" id="configuring-tls-for-orderer-nodes">
<h2>Configuring TLS for orderer nodes<a class="headerlink" href="#configuring-tls-for-orderer-nodes" title="Permalink to this headline">Â¶</a></h2>
<p>To enable TLS on an orderer node, set the following orderer configuration properties:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">General.TLS.Enabled</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">General.TLS.PrivateKey</span></code> = fully qualified path of the file that contains the server
private key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">General.TLS.Certificate</span></code> = fully qualified path of the file that contains the server
certificate</p></li>
</ul>
</div></blockquote>
<p>By default, TLS client authentication is turned off on orderer, as is the case with peer.
To enable TLS client authentication, set the following config property:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">General.TLS.ClientAuthRequired</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
</ul>
</div></blockquote>
<p>TLS with client authentication can also be enabled by setting the following environment
variables:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ORDERER_GENERAL_TLS_ENABLED</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORDERER_GENERAL_TLS_PRIVATEKEY</span></code> = fully qualified path of the file that contains the
server private key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORDERER_GENERAL_TLS_CERTIFICATE</span></code> = fully qualified path of the file that contains the
server certificate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORDERER_GENERAL_TLS_CLIENTAUTHREQUIRED</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p>
<p>When an orderer participates in a channel, root CA certificate chains of the channel members are
read from the config block of the channel and are added to the TLS server and client
root CAs data structure. So, orderer to orderer communication
should work seamlessly. However, if needed, you can add additional root CA certificates
by setting <code class="docutils literal notranslate"><span class="pre">General.TLS.RootCAs</span></code> and <code class="docutils literal notranslate"><span class="pre">General.TLS.ClientRootCAs</span></code>.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configuring-tls-for-the-peer-cli">
<h2>Configuring TLS for the peer CLI<a class="headerlink" href="#configuring-tls-for-the-peer-cli" title="Permalink to this headline">Â¶</a></h2>
<p>The following environment variables must be set when running peer CLI commands against a
TLS enabled peer node:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_ENABLED</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_ROOTCERT_FILE</span></code> = fully qualified path of the file that contains cert chain
of the CA that issued the TLS server cert</p></li>
</ul>
<p>If TLS client authentication is also enabled on the remote server, the following variables
must to be set in addition to those above:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CLIENTAUTHREQUIRED</span></code> = <code class="docutils literal notranslate"><span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CLIENTCERT_FILE</span></code> = fully qualified path of the client certificate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_TLS_CLIENTKEY_FILE</span></code> = fully qualified path of the client private key</p></li>
</ul>
<p>When running a command that connects to orderer service, like <cite>peer channel &lt;create|update|fetch&gt;</cite>
or <cite>peer chaincode &lt;invoke&gt;</cite>, following command line arguments must also be specified
if TLS is enabled on the orderer:</p>
<ul class="simple">
<li><p>â€“tls</p></li>
<li><p>â€“cafile &lt;fully qualified path of the file that contains cert chain of the orderer CA&gt;</p></li>
</ul>
<p>If TLS client authentication is enabled on the orderer, the following arguments must be specified
as well:</p>
<ul class="simple">
<li><p>â€“clientauth</p></li>
<li><p>â€“keyfile &lt;fully qualified path of the file that contains the client private key&gt;</p></li>
<li><p>â€“certfile &lt;fully qualified path of the file that contains the client certificate&gt;</p></li>
</ul>
</div>
<div class="section" id="debugging-tls-issues">
<h2>Debugging TLS issues<a class="headerlink" href="#debugging-tls-issues" title="Permalink to this headline">Â¶</a></h2>
<p>Before debugging TLS issues, it is advisable to enable <code class="docutils literal notranslate"><span class="pre">GRPC</span> <span class="pre">debug</span></code> on both the TLS client
and the server side to get additional information. To enable <code class="docutils literal notranslate"><span class="pre">GRPC</span> <span class="pre">debug</span></code>, set the
environment variable <code class="docutils literal notranslate"><span class="pre">FABRIC_LOGGING_SPEC</span></code> to include <code class="docutils literal notranslate"><span class="pre">grpc=debug</span></code>. For example, to
set the default logging level to <code class="docutils literal notranslate"><span class="pre">INFO</span></code> and the GRPC logging level to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>, set
the logging specification to <code class="docutils literal notranslate"><span class="pre">grpc=debug:info</span></code>.</p>
<p>If you see the error message <code class="docutils literal notranslate"><span class="pre">remote</span> <span class="pre">error:</span> <span class="pre">tls:</span> <span class="pre">bad</span> <span class="pre">certificate</span></code> on the client side, it
usually means that the TLS server has enabled client authentication and the server either did
not receive the correct client certificate or it received a client certificate that it does
not trust. Make sure the client is sending its certificate and that it has been signed by one
of the CA certificates trusted by the peer or orderer node.</p>
<p>If you see the error message <code class="docutils literal notranslate"><span class="pre">remote</span> <span class="pre">error:</span> <span class="pre">tls:</span> <span class="pre">bad</span> <span class="pre">certificate</span></code> in your chaincode logs,
ensure that your chaincode has been built using the chaincode shim provided with Fabric v1.1
or newer.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="logging-control.html" title="previous page">Logging Control</a>
    <a class='right-next' id="next-link" href="raft_configuration.html" title="next page">Configuring and operating a Raft ordering service</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
  </body>
</html>