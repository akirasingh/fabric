
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using a Hardware Security Module (HSM) &#8212; hyperledger-fabricdocs master documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Channel Configuration (configtx)" href="configtx.html" />
    <link rel="prev" title="Taking ledger snapshots and using them to join channels" href="peer_ledger_snapshot.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="index.html">
    
      <p class="title">hyperledger-fabricdocs</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="intro.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="whatsnew.html">What’s new in Hyperledger Fabric v2.x</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href=""></a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="key_concepts.html">Key Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started.html">Getting Started - Install</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started_run_fabric.html">Getting Started - Run Fabric</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="developapps/developing_applications.html">Developing Applications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="deployment_guide_overview.html">Deploying a production network</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="ops_guide.html">Operations Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="upgrade.html">Upgrading to the latest release</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="command_ref.html">Commands Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="architecture.html">Architecture Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="Fabric-FAQ.html">Frequently Asked Questions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="CONTRIBUTING.html">Contributions Welcome!</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="glossary.html">Glossary</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="releases.html">Releases</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="questions.html">Still Have Questions?</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="status.html">Status</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="msp.html">Membership Service Providers (MSP)</a>
                </li>
            
          
            
                <li class="">
                    <a href="peer_ledger_snapshot.html">Taking ledger snapshots and using them to join channels</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Using a Hardware Security Module (HSM)</a>
                </li>
            
          
            
                <li class="">
                    <a href="configtx.html">Channel Configuration (configtx)</a>
                </li>
            
          
            
                <li class="">
                    <a href="endorsement-policies.html">Endorsement policies</a>
                </li>
            
          
            
                <li class="">
                    <a href="pluggable_endorsement_and_validation.html">Pluggable transaction endorsement and validation</a>
                </li>
            
          
            
                <li class="">
                    <a href="access_control.html">Access Control Lists (ACL)</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemix.html">MSP Implementation with Identity Mixer</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemixgen.html">Identity Mixer MSP configuration generator (idemixgen)</a>
                </li>
            
          
            
                <li class="">
                    <a href="operations_service.html">The Operations Service</a>
                </li>
            
          
            
                <li class="">
                    <a href="metrics_reference.html">Metrics Reference</a>
                </li>
            
          
            
                <li class="">
                    <a href="cc_launcher.html">External Builders and Launchers</a>
                </li>
            
          
            
                <li class="">
                    <a href="cc_service.html">Chaincode as an external service</a>
                </li>
            
          
            
                <li class="">
                    <a href="error-handling.html">Error handling</a>
                </li>
            
          
            
                <li class="">
                    <a href="logging-control.html">Logging Control</a>
                </li>
            
          
            
                <li class="">
                    <a href="enable_tls.html">Securing Communication With Transport Layer Security (TLS)</a>
                </li>
            
          
            
                <li class="">
                    <a href="raft_configuration.html">Configuring and operating a Raft ordering service</a>
                </li>
            
          
            
                <li class="">
                    <a href="kafka_raft_migration.html">Migrating from Kafka to Raft</a>
                </li>
            
          
            
                <li class="">
                    <a href="kafka.html">Bringing up a Kafka-based Ordering Service</a>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#configuring-an-hsm" class="nav-link">Configuring an HSM</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#example" class="nav-link">Example</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#setting-up-a-network-using-hsm" class="nav-link">Setting up a network using HSM</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#before-you-begin" class="nav-link">Before you begin</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#using-an-hsm-with-a-fabric-ca" class="nav-link">Using an HSM with a Fabric CA</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#using-an-hsm-with-your-own-ca" class="nav-link">Using an HSM with your own CA</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="using-a-hardware-security-module-hsm">
<h1>Using a Hardware Security Module (HSM)<a class="headerlink" href="#using-a-hardware-security-module-hsm" title="Permalink to this headline">¶</a></h1>
<p>The cryptographic operations performed by Fabric nodes can be delegated to
a Hardware Security Module (HSM).  An HSM protects your private keys and
handles cryptographic operations, allowing your peers and orderer nodes to
sign and endorse transactions without exposing their private keys.  If you
require compliance with government standards such as FIPS 140-2, there are
multiple certified HSMs from which to choose.</p>
<p>Fabric currently leverages the PKCS11 standard to communicate with an HSM.</p>
<div class="section" id="configuring-an-hsm">
<h2>Configuring an HSM<a class="headerlink" href="#configuring-an-hsm" title="Permalink to this headline">¶</a></h2>
<p>To use an HSM with your Fabric node, you need to update the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> (Crypto Service
Provider) section of the node configuration file such as core.yaml or
orderer.yaml. In the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section, you need to select PKCS11 as the provider and
enter the path to the PKCS11 library that you would like to use. You also need
to provide the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code> of the token that you created for your cryptographic
operations. You can use one token to generate and store multiple keys.</p>
<p>The prebuilt Hyperledger Fabric Docker images are not enabled to use PKCS11. If
you are deploying Fabric using docker, you need to build your own images and
enable PKCS11 using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">docker</span> <span class="n">GO_TAGS</span><span class="o">=</span><span class="n">pkcs11</span>
</pre></div>
</div>
<p>You also need to ensure that the PKCS11 library is available to be used by the
node by installing it or mounting it inside the container.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The following example demonstrates how to configure a Fabric node to use an HSM.</p>
<p>First, you will need to install an implementation of the PKCS11 interface. This
example uses the <a class="reference external" href="https://github.com/opendnssec/SoftHSMv2">softhsm</a> open source
implementation. After downloading and configuring softhsm, you will need to set
the SOFTHSM2_CONF environment variable to point to the softhsm2 configuration
file.</p>
<p>You can then use softhsm to create the token that will handle the cryptographic
operations of your Fabric node inside an HSM slot. In this example, we create a
token labelled “fabric” and set the pin to “71811222”. After you have created
the token, update the configuration file to use PKCS11 and your token as the
crypto service provider. You can find an example <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################</span>
<span class="c1"># BCCSP (BlockChain Crypto Service Provider) section is used to select which</span>
<span class="c1"># crypto library implementation to use</span>
<span class="c1">#############################################################################</span>
<span class="n">bccsp</span><span class="p">:</span>
  <span class="n">default</span><span class="p">:</span> <span class="n">PKCS11</span>
  <span class="n">pkcs11</span><span class="p">:</span>
    <span class="n">Library</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
    <span class="n">Pin</span><span class="p">:</span> <span class="s2">&quot;71811222&quot;</span>
    <span class="n">Label</span><span class="p">:</span> <span class="n">fabric</span>
    <span class="nb">hash</span><span class="p">:</span> <span class="n">SHA2</span>
    <span class="n">security</span><span class="p">:</span> <span class="mi">256</span>
    <span class="n">Immutable</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<p>By default, when private keys are generated using the HSM, the private key is mutable, meaning PKCS11 private key  attributes can be changed after the key is generated. Setting <code class="docutils literal notranslate"><span class="pre">Immutable</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> means that the private key attributes cannot be altered after key generation. Before you configure immutability by setting <code class="docutils literal notranslate"><span class="pre">Immutable:</span> <span class="pre">true</span></code>, ensure that PKCS11 object copy is supported by the HSM.</p>
<p>You can also use environment variables to override the relevant fields of the configuration file. If you are connecting to softhsm2 using the Fabric CA server, you could set the following environment variables or directly set the corresponding values in the CA server config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FABRIC_CA_SERVER_BCCSP_DEFAULT</span><span class="o">=</span><span class="n">PKCS11</span>
<span class="n">FABRIC_CA_SERVER_BCCSP_PKCS11_LIBRARY</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
<span class="n">FABRIC_CA_SERVER_BCCSP_PKCS11_PIN</span><span class="o">=</span><span class="mi">71811222</span>
<span class="n">FABRIC_CA_SERVER_BCCSP_PKCS11_LABEL</span><span class="o">=</span><span class="n">fabric</span>
</pre></div>
</div>
<p>If you are connecting to softhsm2 using the Fabric peer, you could set the following environment variables or directly set the corresponding values in the peer config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CORE_PEER_BCCSP_DEFAULT</span><span class="o">=</span><span class="n">PKCS11</span>
<span class="n">CORE_PEER_BCCSP_PKCS11_LIBRARY</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
<span class="n">CORE_PEER_BCCSP_PKCS11_PIN</span><span class="o">=</span><span class="mi">71811222</span>
<span class="n">CORE_PEER_BCCSP_PKCS11_LABEL</span><span class="o">=</span><span class="n">fabric</span>
</pre></div>
</div>
<p>If you are connecting to softhsm2 using the Fabric orderer, you could set the following environment variables or directly set the corresponding values in the orderer config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ORDERER_GENERAL_BCCSP_DEFAULT</span><span class="o">=</span><span class="n">PKCS11</span>
<span class="n">ORDERER_GENERAL_BCCSP_PKCS11_LIBRARY</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
<span class="n">ORDERER_GENERAL_BCCSP_PKCS11_PIN</span><span class="o">=</span><span class="mi">71811222</span>
<span class="n">ORDERER_GENERAL_BCCSP_PKCS11_LABEL</span><span class="o">=</span><span class="n">fabric</span>
</pre></div>
</div>
<p>If you are deploying your nodes using docker compose, after building your own
images, you can update your docker compose files to mount the softhsm library
and configuration file inside the container using volumes. As an example, you
would add the following environment and volumes variables to your docker compose
file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">environment</span><span class="p">:</span>
     <span class="o">-</span> <span class="n">SOFTHSM2_CONF</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">file</span>
  <span class="n">volumes</span><span class="p">:</span>
     <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">softhsm</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">file</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">file</span>
     <span class="o">-</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">Cellar</span><span class="o">/</span><span class="n">softhsm</span><span class="o">/</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">softhsm</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-up-a-network-using-hsm">
<h2>Setting up a network using HSM<a class="headerlink" href="#setting-up-a-network-using-hsm" title="Permalink to this headline">¶</a></h2>
<p>If you are deploying Fabric nodes using an HSM, your private keys need to be
generated and stored inside the HSM rather than inside the <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder of the node’s
local MSP folder. The <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder of the MSP will remain empty. Instead,
the Fabric node will use the subject key identifier of the signing certificate
in the <code class="docutils literal notranslate"><span class="pre">signcerts</span></code> folder to retrieve the private key from inside the HSM.
The process for creating the node MSP folder differs depending on whether you
are using a Fabric Certificate Authority (CA) your own CA.</p>
<div class="section" id="before-you-begin">
<h3>Before you begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline">¶</a></h3>
<p>Before configuring a Fabric node to use an HSM, you should have completed the following steps:</p>
<ol class="simple">
<li><p>Created a partition on your HSM Server and recorded the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code> of the partition.</p></li>
<li><p>Followed instructions in the documentation from your HSM provider to configure an HSM Client that communicates with your HSM server.</p></li>
</ol>
</div>
<div class="section" id="using-an-hsm-with-a-fabric-ca">
<h3>Using an HSM with a Fabric CA<a class="headerlink" href="#using-an-hsm-with-a-fabric-ca" title="Permalink to this headline">¶</a></h3>
<p>You can set up a Fabric CA to use an HSM by making the same edits to the CA server configuration file as you would make to a peer or ordering node. Because you can use the Fabric CA to generate keys inside an HSM, the process of creating the local MSP folders is straightforward. Use the following steps:</p>
<ol class="simple">
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the Fabric CA server configuration file and point to the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code> that you created for your HSM. When the Fabric CA server starts, the private key is generated and stored in the HSM. If you are not concerned about exposing your CA signing certificate, you can skip this step and only configure an HSM for your peer or ordering nodes, described in the next steps.</p></li>
<li><p>Use the Fabric CA client to register the peer or ordering node identities with your CA.</p></li>
<li><p>Before you deploy a peer or ordering node with HSM support, you need to enroll the node identity by storing its private key in the HSM. Edit the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the Fabric CA client config file or use the associated environment variables to point to the HSM configuration for your peer or ordering node. In the Fabric CA Client configuration file, replace the default <code class="docutils literal notranslate"><span class="pre">SW</span></code> configuration with the <code class="docutils literal notranslate"><span class="pre">PKCS11</span></code> configuration and provide the values for your own HSM:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bccsp</span><span class="p">:</span>
  <span class="n">default</span><span class="p">:</span> <span class="n">PKCS11</span>
  <span class="n">pkcs11</span><span class="p">:</span>
    <span class="n">Library</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
    <span class="n">Pin</span><span class="p">:</span> <span class="s2">&quot;71811222&quot;</span>
    <span class="n">Label</span><span class="p">:</span> <span class="n">fabric</span>
    <span class="nb">hash</span><span class="p">:</span> <span class="n">SHA2</span>
    <span class="n">security</span><span class="p">:</span> <span class="mi">256</span>
    <span class="n">Immutable</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<p>Then for each node, use the Fabric CA client to generate the peer or ordering node’s MSP folder by enrolling against the node identity that you registered in step 2. Instead of storing the private key in the <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder of the associated MSP, the enroll command uses the node’s HSM to generate and store the private key for the peer or ordering node. The <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder remains empty.</p>
<ol class="simple">
<li><p>To configure a peer or ordering node to use the HSM, similarly update the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the peer or orderer configuration file to use PKCS11 and provide the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code>. Also, edit the value of the <code class="docutils literal notranslate"><span class="pre">mspConfigPath</span></code> (for a peer node) or the <code class="docutils literal notranslate"><span class="pre">LocalMSPDir</span></code> (for an ordering node) to point to the MSP folder that was generated in the previous step using the Fabric CA client. Now that the peer or ordering node is configured to use HSM, when you start the node it will be able sign and endorse transactions with the private key protected by the HSM.</p></li>
</ol>
</div>
<div class="section" id="using-an-hsm-with-your-own-ca">
<h3>Using an HSM with your own CA<a class="headerlink" href="#using-an-hsm-with-your-own-ca" title="Permalink to this headline">¶</a></h3>
<p>If you are using your own Certificate Authority to deploy Fabric components, you
can use an HSM using the following steps:</p>
<ol class="simple">
<li><p>Configure your CA to communicate with an HSM using PKCS11 and create a <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code>.
Then use your CA to generate the private key and signing certificate for each
node, with the private key generated inside the HSM.</p></li>
<li><p>Use your CA to build the peer or ordering node MSP folder. Place the signing certificate that you generated in step 1 inside the <code class="docutils literal notranslate"><span class="pre">signcerts</span></code> folder. You can leave the <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder empty.</p></li>
<li><p>To configure a peer or ordering node to use the HSM, similarly update the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the peer or orderer configuration file to use PKCS11 andand provide the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code>. Edit the value of the <code class="docutils literal notranslate"><span class="pre">mspConfigPath</span></code> (for a peer node) or the <code class="docutils literal notranslate"><span class="pre">LocalMSPDir</span></code> (for an ordering node) to point to the MSP folder that was generated in the previous step using the Fabric CA client. Now that the peer or ordering node is configured to use HSM, when you start the node it will be able sign and endorse transactions with the private key protected by the HSM.</p></li>
</ol>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="peer_ledger_snapshot.html" title="previous page">Taking ledger snapshots and using them to join channels</a>
    <a class='right-next' id="next-link" href="configtx.html" title="next page">Channel Configuration (configtx)</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
  </body>
</html>