
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planning for a production peer &#8212; hyperledger-fabricdocs master documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Checklist for a production peer" href="peerchecklist.html" />
    <link rel="prev" title="Deploying a production network" href="../deployment_guide_overview.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <p class="title">hyperledger-fabricdocs</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../intro.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../whatsnew.html">What’s new in Hyperledger Fabric v2.x</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href=""></a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../key_concepts.html">Key Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started.html">Getting Started - Install</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started_run_fabric.html">Getting Started - Run Fabric</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../developapps/developing_applications.html">Developing Applications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../deployment_guide_overview.html">Deploying a production network</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../ops_guide.html">Operations Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../upgrade.html">Upgrading to the latest release</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../command_ref.html">Commands Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../architecture.html">Architecture Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../Fabric-FAQ.html">Frequently Asked Questions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../CONTRIBUTING.html">Contributions Welcome!</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../glossary.html">Glossary</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../releases.html">Releases</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../questions.html">Still Have Questions?</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../status.html">Status</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#generate-peer-identities-and-membership-service-providers-msps" class="nav-link">Generate peer identities and Membership Service Providers (MSPs)</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#folder-management" class="nav-link">Folder management</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#certificates-from-a-non-fabric-ca" class="nav-link">Certificates from a non-Fabric CA</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#transport-layer-security-tls-enablement" class="nav-link">Transport Layer Security (TLS) enablement</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#state-database" class="nav-link">State database</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#sizing-your-peer-resources" class="nav-link">Sizing your peer resources</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#storage-considerations" class="nav-link">Storage considerations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#high-availability" class="nav-link">High Availability</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#monitoring" class="nav-link">Monitoring</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#chaincode" class="nav-link">Chaincode</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#gossip" class="nav-link">Gossip</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#service-discovery" class="nav-link">Service Discovery</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="planning-for-a-production-peer">
<h1>Planning for a production peer<a class="headerlink" href="#planning-for-a-production-peer" title="Permalink to this headline">¶</a></h1>
<p>Audience: Architects, network operators, users setting up a production Fabric network who are familiar with Transport Layer Security (TLS), Public Key Infrastructure (PKI) and Membership Service Providers (MSPs).</p>
<p><strong>Note: “chaincode” refers to the packages that are installed on peers, while “smart contracts” refers to the business logic that is agreed to by organizations.</strong></p>
<p>Peer nodes are a fundamental element of a Fabric network because they host ledgers and smart contracts that are used to encapsulate the shared processes and shared information in a blockchain network. These instructions assume you are already familiar with the concept of a <a class="reference external" href="../peers/peers.html">peer</a> and provides guidance for the various decisions you will have to make about a peer you will deploy and join to a production Fabric network channel. If you need to quickly stand up a network for education or testing purposes, check out the <a class="reference external" href="../test_network.html">Fabric test network</a>.</p>
<div class="section" id="generate-peer-identities-and-membership-service-providers-msps">
<h2>Generate peer identities and Membership Service Providers (MSPs)<a class="headerlink" href="#generate-peer-identities-and-membership-service-providers-msps" title="Permalink to this headline">¶</a></h2>
<p>Before proceeding with this topic, you should have reviewed the process for a <a class="reference external" href="https://hyperledger-fabric-ca.readthedocs.io/en/release-1.4/deployguide/ca-deploy-topology.html">Deploying a Certificate Authority (CA)</a> for your organization in order to generate the identities and MSPs for the admins and peers in your organization. To learn how to use a CA to create these identities, check out <a class="reference external" href="https://hyperledger-fabric-ca.readthedocs.io/en/release-1.4/deployguide/use_CA.html">Registering and enrolling identities with a CA</a></p>
<p><strong>Note that the “cryptogen” tool should never be used to generate any identities in a production scenario</strong>.</p>
<div class="section" id="folder-management">
<h3>Folder management<a class="headerlink" href="#folder-management" title="Permalink to this headline">¶</a></h3>
<p>While it is possible to bootstrap a peer using a number of folder structures for your MSPs and certificates, we do recommend a particular <a class="reference external" href="https://hyperledger-fabric-ca.readthedocs.io/en/release-1.4/deployguide/use_CA.html#folder-structure-for-your-org-and-node-admin-identities">folder structure</a> for the sake of consistency and repeatability. These instructions will presume that you have used that folder structure.</p>
</div>
<div class="section" id="certificates-from-a-non-fabric-ca">
<h3>Certificates from a non-Fabric CA<a class="headerlink" href="#certificates-from-a-non-fabric-ca" title="Permalink to this headline">¶</a></h3>
<p>While it is possible to use a non-Fabric CA to generate identities, this process requires that you manually construct the MSP folders the peer needs to be deployed. That process will not be covered here and will instead focus on using a Fabric CA to generate the identities and MSP folders for you.</p>
</div>
<div class="section" id="transport-layer-security-tls-enablement">
<h3>Transport Layer Security (TLS) enablement<a class="headerlink" href="#transport-layer-security-tls-enablement" title="Permalink to this headline">¶</a></h3>
<p>To prevent “man in the middle” attacks and otherwise secure communications, using TLS is a requirement for any production network. Therefore, in addition to registering your peer identities with your organization CA, you will also need to register your peer identities with the TLS CA for the organization. These TLS certificates will be used by the peer when communicating with the network.</p>
</div>
</div>
<div class="section" id="state-database">
<h2>State database<a class="headerlink" href="#state-database" title="Permalink to this headline">¶</a></h2>
<p>Each peer maintains a state database that tracks the current value for all of the assets (also known as “keys”) listed on the ledger. Two types of state databases are supported: External CouchDB (which allows JSON queries of the database) or embedded Goleveldb (which does not). The choice of database largely depends on whether you need the CouchDB JSON query support. If JSON query is not needed, Goleveldb improves performance and requires less management since it is embedded in the peer process. Because all of the peers on a channel must use the same state database, your choice of database might already be dictated by the channels you wish to join.</p>
<p>Beyond the ability to execute JSON queries when using CouchDB, the choice of the database is invisible to a smart contract.</p>
<p>You can review <a class="reference external" href="../couchdb_as_state_database.html#state-database-options">State Database options</a> for more details.</p>
</div>
<div class="section" id="sizing-your-peer-resources">
<h2>Sizing your peer resources<a class="headerlink" href="#sizing-your-peer-resources" title="Permalink to this headline">¶</a></h2>
<p>A peer typically has multiple containers associated with it.</p>
<ul class="simple">
<li><p><strong>Peer container</strong>: Encapsulates the peer process that validates and commits transactions for all channels a peer belongs to. The peer storage includes each channel’s blockchain (in other words, the transaction history), local databases including the state database if using Goleveldb, and any chaincodes that are installed on the peer. The size of peer storage depends on the number of channels, and the number and size of transactions in each channel.</p></li>
<li><p><strong>CouchDB container</strong> (optional): If using CouchDB as the state database, the CouchDB container will be used to store the state database of each channel.</p></li>
<li><p><strong>Chaincode launcher container</strong> (optional): Used to launch a separate container for each chaincode, eliminating the need for a Docker-in-Docker container in the peer container. Note that the chaincode launcher container is not where smart contracts actually run, and is therefore given a smaller default resource than the “smart contracts” container that used to be deployed along with a peer. It only exists to help create the containers where a smart contract will run. You must make your own allowances in your cluster for the containers for the chaincodes deployed by the launcher.</p></li>
<li><p><strong>Chaincode container</strong>: The container where the chaincode runs. Note that the recommended process is to deploy each chaincode into a separate container, even if you have multiple peers on the same channel that have all installed the same chaincode. So if you have three peers on a channel, and install a smart contract on each one, you will have three smart contract containers running. However, if these three peers are on more than one channel using the exact same smart contract, you will still only have three pods running.</p></li>
</ul>
</div>
<div class="section" id="storage-considerations">
<h2>Storage considerations<a class="headerlink" href="#storage-considerations" title="Permalink to this headline">¶</a></h2>
<p>Chaincodes and the ledger (one for each channel) are physically stored on a peer according to the <code class="docutils literal notranslate"><span class="pre">peer.fileSystemPath</span></code> parameter, while identities and MSP are stored according to the <code class="docutils literal notranslate"><span class="pre">peer.mspConfigPath</span></code> parameter (by default, both locations are at <code class="docutils literal notranslate"><span class="pre">/var/hyperledger/production</span></code>). <strong>This file system needs to be protected, secured, and writable by authorized users only</strong> and should also be regularly backed up. Note that the best practice is to use externally mounted volumes for both of these parameters, as they will therefore be easy to reference when restarting or upgrading the peer.</p>
<p>When you configure your peer, you need to decide if the state database will be stored in CouchDB or LevelDB (default) by configuring the <code class="docutils literal notranslate"><span class="pre">ledger.state.stateDatabase</span></code> parameter.</p>
<p>While this topic is focused on how to use the peer binary images, there are important storage considerations you need to be aware of when you run the Fabric images in Docker containers or use Kubernetes. Docker containers requires a volume bind mount that mounts the external folder pathing to your container. This is critical when the container restarts, so that the storage is not lost. Similarly, if you are using Kubernetes, you need to provision storage for the peer and then map it in your Kubernetes pod deployment YAML file.</p>
</div>
<div class="section" id="high-availability">
<h2>High Availability<a class="headerlink" href="#high-availability" title="Permalink to this headline">¶</a></h2>
<p>As part of planning to create a peer, you will need consider your strategy at an organization level in order to ensure zero downtime of your components. This means building redundant components, and specifically redundant peers. To ensure zero downtown, you need at least one redundant peer <strong>in a separate virtual machine</strong> so that peers can go down for maintenance while client applications go on submitting endorsement proposals uninterrupted.</p>
<p>Along similar lines, client applications should be configured to use Service Discovery to ensure that transactions are only submitted to peers that are currently available. As long as at least one peer from each organization is available, and service discovered is being used, any endorsement policy will be able to be satisfied. It is the responsibility of each organization to make sure their high availability strategy is robust enough to ensure that at least one peer owned by their organization is available at all times in every channel they’re joined to.</p>
</div>
<div class="section" id="monitoring">
<h2>Monitoring<a class="headerlink" href="#monitoring" title="Permalink to this headline">¶</a></h2>
<p>All blockchain nodes require careful monitoring, but it is critically important to monitor the peer and ordering nodes. By virtue of being immutable, the ledger inevitably grows. As a result, storage must be monitored and extended as needed. If the storage for a peer is exhausted you also have the option to deploy a new peer with a larger storage allocation and let the ledger sync. In a production environment you should also monitor the CPU and memory allocated to a peer using widely available tooling. If you see the peer struggling to keep up with the transaction load or when performing relatively simple tasks (querying the ledger, for example), it is a sign that you might need to increase its resource allocation.</p>
</div>
<div class="section" id="chaincode">
<h2>Chaincode<a class="headerlink" href="#chaincode" title="Permalink to this headline">¶</a></h2>
<p>Prior to Hyperledger Fabric 2.0, the process used to build and launch chaincode was part of the peer implementation and could not be easily customized. All chaincode installed on the peer would be “built” using language specific logic hard coded in the peer. This build process would generate a Docker container image that would be launched to execute chaincode that connected as a client to the peer.</p>
<p>This approach limited chaincode implementations to a handful of languages, required Docker to be part of the deployment environment, prevented running chaincode as a long-running server process, and required that the peer have privileged access to the chaincode container.</p>
<p>Starting with Fabric 2.0, External Builders and Launchers enable operators to extend the peer with programs that can build, launch, and discover chaincode. To leverage this capability on peers that already exist you will need to create your own buildpack and then modify <code class="docutils literal notranslate"><span class="pre">core.yaml</span></code> to include a new externalBuilder configuration element which lets the peer know an external builder is available.</p>
</div>
<div class="section" id="gossip">
<h2>Gossip<a class="headerlink" href="#gossip" title="Permalink to this headline">¶</a></h2>
<p>Peers leverage the <a class="reference external" href="../gossip.html">gossip data dissemination protocol</a> to broadcast ledger and channel data in a scalable fashion. Gossip messaging is continuous, and each peer on a channel is constantly receiving data from multiple peers, including peers in other organizations (if cross-organization gossip is enabled).</p>
<p>For peer gossip to work you need to configure four parameters. Three of them — <code class="docutils literal notranslate"><span class="pre">peer.gossip.bootstrap</span></code>, <code class="docutils literal notranslate"><span class="pre">peer.gossip.endpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">peer.gossip.externalEndpoint</span></code> — are in the peer’s <code class="docutils literal notranslate"><span class="pre">core.yaml</span></code> file. The fourth enables gossip between organization by specifying an anchor peer in the channel configuration.</p>
<p>To reduce network traffic, in Fabric v2.2 the default core.yaml is configured for peers to pull blocks from the ordering service instead of through gossip dissemination among peers (with the exception of private data, which are still sent from peer to peer using gossip). To get all blocks from the orderer, you must use the following parameters in the <code class="docutils literal notranslate"><span class="pre">core.yaml</span></code> file:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">peer.gossip.useLeaderElection</span> <span class="pre">=</span> <span class="pre">false</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peer.gossip.orgLeader</span> <span class="pre">=</span> <span class="pre">true</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peer.gossip.state.enabled</span> <span class="pre">=</span> <span class="pre">false</span></code></p></li>
</ul>
<p>If all peers have <code class="docutils literal notranslate"><span class="pre">orgLeader=true</span></code> (recommended), then each peer will get blocks from the ordering service.</p>
<div class="section" id="service-discovery">
<h3>Service Discovery<a class="headerlink" href="#service-discovery" title="Permalink to this headline">¶</a></h3>
<p>In any network it is possible that peer nodes can be down for maintenance, unreachable due to network issues, or the peer ledger has fallen behind while being offline. For this reason, Fabric includes a “discovery service” that enables client applications that use the SDK to locate good candidate peers to target with endorsement requests. If service discovery is not enabled, when a client application targets a peer that is offline, the request fails and will need to be resubmitted to another peer. The discovery service runs on peers and uses the network metadata information maintained by the gossip communication layer to find out which peers are online and can be targeted for requests.</p>
<p>Service discovery (and private data) requires that gossip is enabled, therefore you should configure the <code class="docutils literal notranslate"><span class="pre">peer.gossip.bootstrap</span></code>, <code class="docutils literal notranslate"><span class="pre">peer.gossip.endpoint</span></code> , and <code class="docutils literal notranslate"><span class="pre">peer.gossip.externalEndpoint</span></code> parameters, as well as anchor peers on each channel, to take advantage of this feature.</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="../deployment_guide_overview.html" title="previous page">Deploying a production network</a>
    <a class='right-next' id="next-link" href="peerchecklist.html" title="next page">Checklist for a production peer</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
  </body>
</html>