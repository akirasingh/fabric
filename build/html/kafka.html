
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bringing up a Kafka-based Ordering Service &#8212; hyperledger-fabricdocs master documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Upgrading to the latest release" href="upgrade.html" />
    <link rel="prev" title="Migrating from Kafka to Raft" href="kafka_raft_migration.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="index.html">
    
      <p class="title">hyperledger-fabricdocs</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="intro.html">Introduction</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="whatsnew.html">What’s new in Hyperledger Fabric v2.x</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href=""></a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="key_concepts.html">Key Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started.html">Getting Started - Install</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started_run_fabric.html">Getting Started - Run Fabric</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="developapps/developing_applications.html">Developing Applications</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="deployment_guide_overview.html">Deploying a production network</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="ops_guide.html">Operations Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="upgrade.html">Upgrading to the latest release</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="command_ref.html">Commands Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="architecture.html">Architecture Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="Fabric-FAQ.html">Frequently Asked Questions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="CONTRIBUTING.html">Contributions Welcome!</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="glossary.html">Glossary</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="releases.html">Releases</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="questions.html">Still Have Questions?</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="status.html">Status</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="msp.html">Membership Service Providers (MSP)</a>
                </li>
            
          
            
                <li class="">
                    <a href="peer_ledger_snapshot.html">Taking ledger snapshots and using them to join channels</a>
                </li>
            
          
            
                <li class="">
                    <a href="hsm.html">Using a Hardware Security Module (HSM)</a>
                </li>
            
          
            
                <li class="">
                    <a href="configtx.html">Channel Configuration (configtx)</a>
                </li>
            
          
            
                <li class="">
                    <a href="endorsement-policies.html">Endorsement policies</a>
                </li>
            
          
            
                <li class="">
                    <a href="pluggable_endorsement_and_validation.html">Pluggable transaction endorsement and validation</a>
                </li>
            
          
            
                <li class="">
                    <a href="access_control.html">Access Control Lists (ACL)</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemix.html">MSP Implementation with Identity Mixer</a>
                </li>
            
          
            
                <li class="">
                    <a href="idemixgen.html">Identity Mixer MSP configuration generator (idemixgen)</a>
                </li>
            
          
            
                <li class="">
                    <a href="operations_service.html">The Operations Service</a>
                </li>
            
          
            
                <li class="">
                    <a href="metrics_reference.html">Metrics Reference</a>
                </li>
            
          
            
                <li class="">
                    <a href="cc_launcher.html">External Builders and Launchers</a>
                </li>
            
          
            
                <li class="">
                    <a href="cc_service.html">Chaincode as an external service</a>
                </li>
            
          
            
                <li class="">
                    <a href="error-handling.html">Error handling</a>
                </li>
            
          
            
                <li class="">
                    <a href="logging-control.html">Logging Control</a>
                </li>
            
          
            
                <li class="">
                    <a href="enable_tls.html">Securing Communication With Transport Layer Security (TLS)</a>
                </li>
            
          
            
                <li class="">
                    <a href="raft_configuration.html">Configuring and operating a Raft ordering service</a>
                </li>
            
          
            
                <li class="">
                    <a href="kafka_raft_migration.html">Migrating from Kafka to Raft</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Bringing up a Kafka-based Ordering Service</a>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#caveat-emptor" class="nav-link">Caveat emptor</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#big-picture" class="nav-link">Big picture</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#steps" class="nav-link">Steps</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#additional-considerations" class="nav-link">Additional considerations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#kafka-protocol-version-compatibility" class="nav-link">Kafka Protocol Version Compatibility</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#debugging" class="nav-link">Debugging</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="bringing-up-a-kafka-based-ordering-service">
<h1>Bringing up a Kafka-based Ordering Service<a class="headerlink" href="#bringing-up-a-kafka-based-ordering-service" title="Permalink to this headline">¶</a></h1>
<div class="section" id="caveat-emptor">
<span id="kafka-caveat"></span><h2>Caveat emptor<a class="headerlink" href="#caveat-emptor" title="Permalink to this headline">¶</a></h2>
<p>This document assumes that the reader knows how to set up a Kafka cluster and a
ZooKeeper ensemble, and keep them secure for general usage by preventing
unauthorized access. The sole purpose of this guide is to identify the steps you
need to take so as to have a set of Hyperledger Fabric ordering service nodes
(OSNs) use your Kafka cluster and provide an ordering service to your blockchain
network.</p>
<p>For information about the role orderers play in a network and in a transaction
flow, checkout our <a class="reference internal" href="orderer/ordering_service.html"><span class="doc">The Ordering Service</span></a> documentation.</p>
<p>For information on how to set up an ordering node, check out our <a class="reference internal" href="deployorderer/ordererplan.html"><span class="doc">Planning for an ordering service</span></a>
documentation.</p>
<p>For information about configuring Raft ordering services, check out <a class="reference internal" href="raft_configuration.html"><span class="doc">Configuring and operating a Raft ordering service</span></a>.</p>
</div>
<div class="section" id="big-picture">
<h2>Big picture<a class="headerlink" href="#big-picture" title="Permalink to this headline">¶</a></h2>
<p>Each channel maps to a separate single-partition topic in Kafka. When an OSN
receives transactions via the <code class="docutils literal notranslate"><span class="pre">Broadcast</span></code> RPC, it checks to make sure that the
broadcasting client has permissions to write on the channel, then relays (i.e.
produces) those transactions to the appropriate partition in Kafka. This
partition is also consumed by the OSN which groups the received transactions
into blocks locally, persists them in its local ledger, and serves them to
receiving clients via the <code class="docutils literal notranslate"><span class="pre">Deliver</span></code> RPC. For low-level details, refer to <a class="reference external" href="https://docs.google.com/document/d/19JihmW-8blTzN99lAubOfseLUZqdrB6sBR0HsRgCAnY/edit">the
document that describes how we came to this design</a>.
<strong>Figure 8</strong> is a schematic representation of the process described above.</p>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h2>
<p>Let <code class="docutils literal notranslate"><span class="pre">K</span></code> and <code class="docutils literal notranslate"><span class="pre">Z</span></code> be the number of nodes in the Kafka cluster and the
ZooKeeper ensemble respectively:</p>
<ol class="arabic simple">
<li><p>At a minimum, <code class="docutils literal notranslate"><span class="pre">K</span></code> should be set to 4. (As we will explain in Step 4 below,
this is the minimum number of nodes necessary in order to exhibit crash fault
tolerance, i.e. with 4 brokers, you can have 1 broker go down, all channels
will continue to be writeable and readable, and new channels can be created.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Z</span></code> will either be 3, 5, or 7. It has to be an odd number to avoid
split-brain scenarios, and larger than 1 in order to avoid single point of
failures. Anything beyond 7 ZooKeeper servers is considered overkill.</p></li>
</ol>
<p>Then proceed as follows:</p>
<ol class="arabic" start="3">
<li><p>Orderers: <strong>Encode the Kafka-related information in the network’s genesis
block.</strong> If you are using <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code>, edit <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code>. Alternatively,
pick a preset profile for the system channel’s genesis block—  so that:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Orderer.OrdererType</span></code> is set to <code class="docutils literal notranslate"><span class="pre">kafka</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Orderer.Kafka.Brokers</span></code> contains the address of <em>at least two</em> of the Kafka
brokers in your cluster in <code class="docutils literal notranslate"><span class="pre">IP:port</span></code> notation. The list does not need to be
exhaustive. (These are your bootstrap brokers.)</p></li>
</ul>
</li>
<li><p>Orderers: <strong>Set the maximum block size.</strong> Each block will have at most
<code class="docutils literal notranslate"><span class="pre">Orderer.AbsoluteMaxBytes</span></code> bytes (not including headers), a value that you can
set in <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code>. Let the value you pick here be <code class="docutils literal notranslate"><span class="pre">A</span></code> and make note of
it —– it will affect how you configure your Kafka brokers in Step 6.</p></li>
<li><p>Orderers: <strong>Create the genesis block.</strong> Use <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code>. The settings you
picked in Steps 3 and 4 above are system-wide settings, i.e. they apply across the
network for all the OSNs. Make note of the genesis block’s location.</p></li>
<li><p>Kafka cluster: <strong>Configure your Kafka brokers appropriately.</strong> Ensure that every
Kafka broker has these keys configured:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unclean.leader.election.enable</span> <span class="pre">=</span> <span class="pre">false</span></code> — Data consistency is key in a
blockchain environment. We cannot have a channel leader chosen outside of
the in-sync replica set, or we run the risk of overwriting the offsets that
the previous leader produced, and —as a result— rewrite the blockchain that
the orderers produce.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min.insync.replicas</span> <span class="pre">=</span> <span class="pre">M</span></code> — Where you pick a value <code class="docutils literal notranslate"><span class="pre">M</span></code> such that
<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;</span> <span class="pre">N</span></code> (see <code class="docutils literal notranslate"><span class="pre">default.replication.factor</span></code> below). Data is
considered committed when it is written to at least <code class="docutils literal notranslate"><span class="pre">M</span></code> replicas
(which are then considered in-sync and belong to the in-sync replica
set, or ISR). In any other case, the write operation returns an error.
Then:</p>
<ul class="simple">
<li><p>If up to <code class="docutils literal notranslate"><span class="pre">N-M</span></code> replicas —out of the <code class="docutils literal notranslate"><span class="pre">N</span></code> that the channel data is
written to become unavailable, operations proceed normally.</p></li>
<li><p>If more replicas become unavailable, Kafka cannot maintain an ISR set
of <code class="docutils literal notranslate"><span class="pre">M,</span></code> so it stops accepting writes. Reads work without issues.
The channel becomes writeable again when <code class="docutils literal notranslate"><span class="pre">M</span></code> replicas get in-sync.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">default.replication.factor</span> <span class="pre">=</span> <span class="pre">N</span></code> — Where you pick a value <code class="docutils literal notranslate"><span class="pre">N</span></code> such
that <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">&lt;</span> <span class="pre">K</span></code>. A replication factor of <code class="docutils literal notranslate"><span class="pre">N</span></code> means that each channel will
have its data replicated to <code class="docutils literal notranslate"><span class="pre">N</span></code> brokers. These are the candidates for the
ISR set of a channel. As we noted in the <code class="docutils literal notranslate"><span class="pre">min.insync.replicas</span> <span class="pre">section</span></code>
above, not all of these brokers have to be available all the time. <code class="docutils literal notranslate"><span class="pre">N</span></code>
should be set <em>strictly smaller</em> to <code class="docutils literal notranslate"><span class="pre">K</span></code> because channel creations cannot
go forward if less than <code class="docutils literal notranslate"><span class="pre">N</span></code> brokers are up. So if you set <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">=</span> <span class="pre">K</span></code>, a
single broker going down means that no new channels can be created on the
blockchain network — the crash fault tolerance of the ordering service is
non-existent.</p>
<p>Based on what we’ve described above, the minimum allowed values for <code class="docutils literal notranslate"><span class="pre">M</span></code>
and <code class="docutils literal notranslate"><span class="pre">N</span></code> are 2 and 3 respectively. This configuration allows for the
creation of new channels to go forward, and for all channels to continue
to be writeable.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">message.max.bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">replica.fetch.max.bytes</span></code> should be set to
a value larger than <code class="docutils literal notranslate"><span class="pre">A</span></code>, the value you picked in <code class="docutils literal notranslate"><span class="pre">Orderer.AbsoluteMaxBytes</span></code>
in Step 4 above. Add some buffer to account for headers —– 1 MiB is more than
enough. The following condition applies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Orderer</span><span class="o">.</span><span class="n">AbsoluteMaxBytes</span> <span class="o">&lt;</span> <span class="n">replica</span><span class="o">.</span><span class="n">fetch</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">bytes</span> <span class="o">&lt;=</span> <span class="n">message</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">bytes</span>
</pre></div>
</div>
<p>(For completeness, we note that <code class="docutils literal notranslate"><span class="pre">message.max.bytes</span></code> should be strictly
smaller to <code class="docutils literal notranslate"><span class="pre">socket.request.max.bytes</span></code> which is set by default to 100
MiB. If you wish to have blocks larger than 100 MiB you will need to edit
the hard-coded value in <code class="docutils literal notranslate"><span class="pre">brokerConfig.Producer.MaxMessageBytes</span></code> in
<code class="docutils literal notranslate"><span class="pre">fabric/orderer/kafka/config.go</span></code> and rebuild the binary from source.
This is not advisable.)</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">log.retention.ms</span> <span class="pre">=</span> <span class="pre">-1</span></code>. Until the ordering service adds support for
pruning of the Kafka logs, you should disable time-based retention and
prevent segments from expiring. (Size-based retention
— see <code class="docutils literal notranslate"><span class="pre">log.retention.bytes</span></code> — is disabled by default in Kafka at the time
of this writing, so there’s no need to set it explicitly.)</p></li>
</ul>
</li>
<li><p>Orderers: <strong>Point each OSN to the genesis block.</strong> Edit
<code class="docutils literal notranslate"><span class="pre">General.BootstrapFile</span></code> in <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> so that it points to the genesis
block created in Step 5 above. While at it, ensure all other keys in that YAML
file are set appropriately.</p></li>
<li><p>Orderers: <strong>Adjust polling intervals and timeouts.</strong> (Optional step.)</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Kafka.Retry</span></code> section in the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> file allows you to
adjust the frequency of the metadata/producer/consumer requests, as well as
the socket timeouts. (These are all settings you would expect to see in a
Kafka producer or consumer.)</p></li>
<li><p>Additionally, when a new channel is created, or when an existing channel is
reloaded (in case of a just-restarted orderer), the orderer interacts with
the Kafka cluster in the following ways:</p>
<ul>
<li><p>It creates a Kafka producer (writer) for the Kafka partition that
corresponds to the channel. . It uses that producer to post a no-op
<code class="docutils literal notranslate"><span class="pre">CONNECT</span></code> message to that partition. . It creates a Kafka consumer
(reader) for that partition.</p></li>
<li><p>If any of these steps fail, you can adjust the frequency with which they
are repeated. Specifically they will be re-attempted every
<code class="docutils literal notranslate"><span class="pre">Kafka.Retry.ShortInterval</span></code> for a total of <code class="docutils literal notranslate"><span class="pre">Kafka.Retry.ShortTotal</span></code>,
and then every <code class="docutils literal notranslate"><span class="pre">Kafka.Retry.LongInterval</span></code> for a total of
<code class="docutils literal notranslate"><span class="pre">Kafka.Retry.LongTotal</span></code> until they succeed. Note that the orderer will
be unable to write to or read from a channel until all of the steps above
have been completed successfully.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Set up the OSNs and Kafka cluster so that they communicate over SSL.</strong>
(Optional step, but highly recommended.) Refer to <a class="reference external" href="https://docs.confluent.io/2.0.0/kafka/ssl.html">the Confluent guide</a>
for the Kafka cluster side of the equation, and set the keys under
<code class="docutils literal notranslate"><span class="pre">Kafka.TLS</span></code> in <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> on every OSN accordingly.</p></li>
<li><p><strong>Bring up the nodes in the following order: ZooKeeper ensemble, Kafka
cluster, ordering service nodes.</strong></p></li>
</ol>
</div>
<div class="section" id="additional-considerations">
<h2>Additional considerations<a class="headerlink" href="#additional-considerations" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p><strong>Preferred message size.</strong> In Step 4 above (see <a class="reference internal" href="#steps">Steps</a> section) you can
also set the preferred size of blocks by setting the
<code class="docutils literal notranslate"><span class="pre">Orderer.Batchsize.PreferredMaxBytes</span></code> key. Kafka offers higher throughput
when dealing with relatively small messages; aim for a value no bigger than 1
MiB.</p></li>
<li><p><strong>Using environment variables to override settings.</strong> When using the
sample Kafka and Zookeeper Docker images provided with Fabric (see
<code class="docutils literal notranslate"><span class="pre">images/kafka</span></code> and <code class="docutils literal notranslate"><span class="pre">images/zookeeper</span></code> respectively), you can override a
Kafka broker or a ZooKeeper server’s settings by using environment variables.
Replace the dots of the configuration key with underscores. For example,
<code class="docutils literal notranslate"><span class="pre">KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false</span></code> will allow you to override the
default value of <code class="docutils literal notranslate"><span class="pre">unclean.leader.election.enable</span></code>. The same applies to the
OSNs for their <em>local</em> configuration, i.e. what can be set in <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code>.
For example <code class="docutils literal notranslate"><span class="pre">ORDERER_KAFKA_RETRY_SHORTINTERVAL=1s</span></code> allows you to override the
default value for <code class="docutils literal notranslate"><span class="pre">Orderer.Kafka.Retry.ShortInterval</span></code>.</p></li>
</ol>
</div>
<div class="section" id="kafka-protocol-version-compatibility">
<h2>Kafka Protocol Version Compatibility<a class="headerlink" href="#kafka-protocol-version-compatibility" title="Permalink to this headline">¶</a></h2>
<p>Fabric uses the <a class="reference external" href="https://github.com/Shopify/sarama">sarama client library</a> and
vendors a version of it that supports Kafka 0.10 to 1.0, yet is still known to
work with older versions.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">Kafka.Version</span></code> key in <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code>, you can configure which
version of the Kafka protocol is used to communicate with the Kafka cluster’s
brokers. Kafka brokers are backward compatible with older protocol versions.
Because of a Kafka broker’s backward compatibility with older protocol versions,
upgrading your Kafka brokers to a new version does not require an update of the
<code class="docutils literal notranslate"><span class="pre">Kafka.Version</span></code> key value, but the Kafka cluster might suffer a <a class="reference external" href="https://kafka.apache.org/documentation/#upgrade_11_message_format">performance
penalty</a>
while using an older protocol version.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Set environment variable <code class="docutils literal notranslate"><span class="pre">FABRIC_LOGGING_SPEC</span></code> to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> and set
<code class="docutils literal notranslate"><span class="pre">Kafka.Verbose</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> in <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> .</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="kafka_raft_migration.html" title="previous page">Migrating from Kafka to Raft</a>
    <a class='right-next' id="next-link" href="upgrade.html" title="next page">Upgrading to the latest release</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
  </body>
</html>